function PinUi(a){this.scope=a,this.hasUi=!1,this.isHidden=!1,this.allowPrivateInterfaces=!1,this.offsetLeft=0,this.offsetRight=0,this.leftNavItems=[{className:classes.btnAddnew,label:"ADD NEW TAG",isPrivate:!0,event:function(a,b){var c=function(){0===userInfo[serverKeys.user.tagTotal]?pfunc.openWindow(layout.msgFirstTag,function(){plib.click(plib.getElementsByClassName(classes.formBtnSubmit,this)[0],function(){pfunc.closeWindow(),a.scope.startTaggingMode(a.scope.methodAddNewTag)})}):a.scope.startTaggingMode(a.scope.methodAddNewTag)};pfunc.waitButton(b,messages.leftNavWait),pfunc.checkLogin(c,function(){pfunc.promptLogin(c)},function(){pfunc.unwaitButton(b)})}}]}function PinInst(a,b){this.uid=b,this.image=a,this.imageSrc=plib.attribute(a,settings.altImageSrc)||a.src,this.imageClone=a.cloneNode(!0),this.disallowNodeUpdate=!1,this.allowTagBubble=!0,this.privateElements={},this.settings={},this.dimensions={width:a.width,height:a.height,offsetLeft:cacheImages[b].offset.x,offsetTop:cacheImages[b].offset.y},this.updateInProgress=!1}function Pinup(a,b){return window===this?new Pinup(a,b):(settings=plib.cloneObject(defaultSettings),b&&pfunc.updateSettings(b),pfunc.time(messages.sysLoadTime),pfunc.updateWindowNamespace(),void plib.onDomReady(function(){var c,d=oNamespace.checkSite+globalVars.publicKey,e=function(a){a&&(pfunc.log(messages.serverSet,a),pfunc.updateSettings(a)),b&&pfunc.updateSettings(b),pfunc.systemStart()};return exist?void pfunc.warn(messages.noPubKey):(exist=!0,a&&(globalVars.publicKey=a),c=pfunc.getLocalStorage(d),c?e(c):plib.isUndefined(globalVars.publicKey)||plib.loadJSONP(directory.names.checkSite,{strWebUrl:window.location.hostname},function(a){null!==a&&(e(a),pfunc.setLocalStorage(d,a))}),void plib.addEvent(window,events.unload,pfunc.systemStop))}))}var exist=!1,alive=!1,globalVars={},globalElements={},globalKeyEvents={},cacheImages={},cacheNodes={},cacheTags={},cacheTagData={},cacheEvents={},cacheElements={},queueTagData={},jsonpHandler={},jsonpTimeout={},userInfo={},userHash,userLogged=!1,support={},hiddenImages={},stats={},plib,pfunc,defaultSettings,settings,classes,directory,regex,messages,attributes,names,types,events,html,commonHTML,layout,css,serverKeys,document=window.document,protoString=Object.prototype.toString,windowLocation=window.location.href,defaultView=document.defaultView,consoleObject=window.console,consoleMethods=["log","info","warn","error","time","timeEnd"],cssPrefix="PIN_",tagPrefix="tagId_",sysName="Pinup",ieEventPrefix="on",cssUnit="px",monetarySymbol="$",whiteSpace=" ",asterisk="*",ellipsis="...",webProtos=["http://","https://"],defaultWebProto=webProtos[0],oNamespace={root:sysName,json:"jsonpHandler",globalVars:"globalVars",settings:"settings",defaultSettings:"defaultSettings",user:"user",lib:"lib",fn:"fn",images:"images",nodes:"nodes",tags:"tags",events:"events",elements:"elements",checkSite:"checkSite-",checkImage:"checkImage-",vmlCanvas:"G_vmlCanvasManager"},opacities={full:1,semi:.3},keyCodes={f2:113,esc:27,enter:13,arrowLeft:37,arrowRight:39},splElmIds={window:"GUID-window",document:"GUID-document"},strBool={1:"yes",0:"no"},readyStates={complete:"complete",loaded:"loaded"},NULL_TYPE="null",UNDEFINED_TYPE="undefined",BOOLEAN_TYPE="boolean",NUMBER_TYPE="number",STRING_TYPE="string",OBJECT_TYPE="object",ARRAY_TYPE="array",FUNCTION_TYPE="function",ELEMENT_TYPE="element",DATE_TYPE="date",BOOLEAN_CLASS="[object Boolean]",NUMBER_CLASS="[object Number]",STRING_CLASS="[object String]",ARRAY_CLASS="[object Array]",FUNCTION_CLASS="[object Function]",DATE_CLASS="[object Date]",nLastLoginCheck=0,scrollMem;directory={names:{getTags:"get_tags",getTagSugg:"get_tag_suggestion",register:"register",login:"login",logout:"logout",forgot:"forgot_pass",checkLogin:"check_login",checkImage:"check_image",checkSite:"get_site_settings",tagCreate:"tag_create",tagPosition:"tag_position",tagRemove:"tag_remove",logTagHover:"log_tag_hover"},paths:{twitter:"http://twitter.com/intent/tweet?",facebook:"https://www.facebook.com/sharer.php?",gateway:"http://jbull.ca/work/pinup/gateway/",cdn:"http://jbull.ca/work/pinup/cdn/",website:"http://jbull.ca/work/pinup/"}},directory.paths.webloc=directory.paths.gateway+"webloc.php?u=",directory.paths.hub=directory.paths.gateway+"hub.php",directory.paths.themes=directory.paths.cdn+"frontend-themes/css/",directory.paths.excanvas=directory.paths.cdn+"global-js/excanvas.js",defaultSettings={nMinWidth:250,nMinHeight:200,jsonpTimeout:3e4,scrollDelay:300,navAniSpeed:250,loadImages:[],loadAll:!1,smartLoad:!0,forceListen:!1,alwaysShowTags:!0,cssHelper:!0,posHelper:!0,animations:!0,keyListener:!0,onReady:function(){},onLogout:function(){},onLogin:function(){},themeFile:"",allowFile:"jpg|jpeg|png",allowThemeManager:!1,allowLocalStorage:!1,allowBottomLinks:!1,allowShare:!0,dotSize:"medium",dotOutlineSize:6,canvas:{cornerRadius:5,tailWidth:19,tailHeight:8,stroke:!1,shadow:!0,theme:{backgroundStyle:"radial",backgroundColor:"0-#FFFFFF 1-#CCCCCC",strokeWidth:1,strokeColor:"#000000",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:5,shadowColor:"#000000"}},tooltip:!0,tooltipOrientation:"top",tooltipURL:!0,altImageSrc:"pinsrc",activeParentClass:"allpins",activeChildClass:"pinimg",custom:{}},classes={docBody:cssPrefix+"active",noAnimation:cssPrefix+"noAnimation",noRgbaSupport:cssPrefix+"noRgbaSupport",noBoxShadowSupport:cssPrefix+"noBoxShadowSupport",noBorderRadiusSupport:cssPrefix+"noBorderRadiusSupport",wrapper:cssPrefix+"wrapper",lightbox:cssPrefix+"lightbox",lightboxWindow:cssPrefix+"lightboxWindow",lightboxOverlay:cssPrefix+"lightboxOverlay",lightboxImage:cssPrefix+"lightboxImage",lightboxImageHolder:cssPrefix+"lightboxImageHolder",lightboxNav:cssPrefix+"lightboxNav",lightboxShowLeft:cssPrefix+"lightboxShowLeft",lightboxShowRight:cssPrefix+"lightboxShowRight",lightboxNavIcon:cssPrefix+"lightboxNavIcon",node:cssPrefix+"node",inlineNode:cssPrefix+"inlineNode",sectionBody:cssPrefix+"sectionBody",sectionFooter:cssPrefix+"sectionFooter",image:cssPrefix+"image",overlay:cssPrefix+"overlay",logo:cssPrefix+"logo",button:cssPrefix+"button",lastItem:cssPrefix+"lastItem",noSelect:cssPrefix+"noSelect",handOver:cssPrefix+"handOver",handDrag:cssPrefix+"handDrag",iconLabel:cssPrefix+"iconLabel",guiLeftHolder:cssPrefix+"guiLeftHolder",guiRightHolder:cssPrefix+"guiRightHolder",guiBotL:cssPrefix+"btnBotL",guiTopR:cssPrefix+"btnTopR",btnCancel:cssPrefix+"btnCancel",btnSettings:cssPrefix+"btnSettings",btnAddnew:cssPrefix+"btnAddTag",window:cssPrefix+"window",windowOverlay:cssPrefix+"windowOverlay",windowBackground:cssPrefix+"windowBackground",windowClose:cssPrefix+"windowBtnClose",windowBody:cssPrefix+"windowBody",windowLogout:cssPrefix+"windowLogout",windowUserName:cssPrefix+"windowUserName",windowHeader:cssPrefix+"header",windowTitle:cssPrefix+"title",prompt:cssPrefix+"prompt",promptMessage:cssPrefix+"promptMessage",promptAccept:cssPrefix+"promptAccept",promptDeny:cssPrefix+"promptDeny",modalMsg:cssPrefix+"modalMsg",focus:cssPrefix+"focus",formStyle:cssPrefix+"formStyle",formError:cssPrefix+"formError",formDisabledMsg:cssPrefix+"formDisabledMsg",formErrorRow:cssPrefix+"formErrorRow",formLabel:cssPrefix+"formLabel",formLabelSm:cssPrefix+"formLabel-sm",formTextField:cssPrefix+"textField",formTextArea:cssPrefix+"textArea",formDropDown:cssPrefix+"dropDown",formDropDownDiv:cssPrefix+"dropDownDiv",formBtnSubmit:cssPrefix+"formBtnSubmit",formBtnLeft:cssPrefix+"formBtnLeft",formOptions:cssPrefix+"options",formOption_forgotPass:cssPrefix+"optForgotPass",formOption_backToLogin:cssPrefix+"optBackToLogin",formOption_register:cssPrefix+"optRegister",tag:cssPrefix+"tag",tagSmall:cssPrefix+"tagSmall",tagMedium:cssPrefix+"tagMedium",tagLarge:cssPrefix+"tagLarge",tagHolder:cssPrefix+"tagHolder",tagDot:cssPrefix+"tagDot",tagOutline:cssPrefix+"tagOutline",tagBubble:cssPrefix+"tagBubble",tagBubbleContent:cssPrefix+"tagBubbleContent",tagBubbleCanvas:cssPrefix+"tagBubbleCanvas",tagBubbleButton:cssPrefix+"tagBubbleButton",tagLink:cssPrefix+"tagLink",tagLinkText:cssPrefix+"tagLinkText",tagLinkURL:cssPrefix+"tagLinkURL",tagLinkLike:cssPrefix+"tagLinkLike",tagDirLeft:cssPrefix+"tagDirL",tagDirRight:cssPrefix+"tagDirR",link:cssPrefix+"link",linkHolder:cssPrefix+"linkHolder",linkHolderBackground:cssPrefix+"linkHolderBackground",linkPending:cssPrefix+"linkPending",shareHolder:cssPrefix+"shareHolder",shareHeader:cssPrefix+"shareHeader",shareButtons:cssPrefix+"shareButtons",shareButton:cssPrefix+"shareButton",actionOn:cssPrefix+"on",actionShowWin:cssPrefix+"showWin",taggingMode:cssPrefix+"taggingMode",repositionMode:cssPrefix+"repositionMode",removalMode:cssPrefix+"removalMode"},messages={noImages:sysName+": No images have been found",imageLoaded:sysName+": Image has loaded: %o",imageUnloaded:sysName+": Image has been unloaded: %s",imageNewSrc:sysName+': Image src "%s" was replaced with: "%s"',imageCount:sysName+": We found %i images; %i of those have been loaded and %i of those have been denied",sysDestroyed:sysName+": All instances have been removed",themeLoaded:sysName+': The theme "%s" has loaded',excanvasRequest:sysName+": Excanvas has been requested",excanvasReceived:sysName+": Excanvas has been loaded then initialized and canvas is %s",noPubKey:sysName+": Public key was not provided",alreadyAlive:sysName+": System already active",alreadyDead:sysName+": System does not exist",badInstance:sysName+": Image already contains a valid identifier",noInstance:sysName+": Image does not contain a valid identifier",badTarget:sysName+": Event target is undefined",noImage:sysName+": Aborted due to faulty or non-existant image reference",inBlacklist:sysName+": Image was rejected because it was found in the blacklist %o",imageTooSmall:sysName+": Image was rejected because it did not meet the minimum size requirements: width(%spx/%spx) and height(%spx/%spx) %o",imageNoSrc:sysName+": Image was rejected because it does not have a file source %o",imageBadFile:sysName+': Image was rejected because of an unknown file type "%s" on %o',imageNotFound:sysName+": Image has been removed from the document and will no longer be able to load %o",imageIgnoreSEO:sysName+": Image was rejected because it appears to be a SEO pseudo tag %o",sysNotActive:sysName+": Requested action not performed because the system is not active",eventDuplicate:sysName+': Ignored duplicate event type "%s" on %o',settingDNF:sysName+': Custom setting "%s" was not found',badType:sysName+': Custom setting "%s" was ignored because of mismatched type (expected %s but found %s)',themeNotFound:sysName+': The theme "%s" was not found. The default theme was loaded',jsonp:sysName+": JSONP CALL: %s",serverSet:sysName+": Settings from server: %o",instOutput:sysName+": Instance done: %o",jsonpTimeout:sysName+": JSONP call has timed out on script: %s",sysLoadTime:sysName+": Load Time",noResults:"No results found.",loading:"Loading"+ellipsis,leftNavWait:"THINKING"+ellipsis,formWait:"PLEASE WAIT"+ellipsis,removeTag:"Are you sure you wish to permanently delete this tag?",removeMultiTags:"Are you sure you wish to permanently delete this tag? Caution: There are multiple links associated with this tag.",missingReqInput:"A REQUIRED FIELD IS EMPTY",invalidEmail:"EMAIL ADDRESS IS NOT VALID"},css={display:"display",margin:{top:"marginTop",right:"marginRight",bottom:"marginBottom",left:"marginLeft"},padding:{top:"paddingTop",right:"paddingRight",bottom:"paddingBottom",left:"paddingLeft"},width:"width",height:"height",maxWidth:"maxWidth",maxHeight:"maxHeight",top:"top",right:"right",bottom:"bottom",left:"left",visibility:"visibility",opacity:"opacity",filter:"filter",zIndex:"zIndex",cssFloat:"float",position:"position"},attributes={id:"id",className:"class",style:"style",src:"src",href:"href",rel:"rel",name:"name",type:"type",width:"width",height:"height",align:"align",hspace:"hspace",vspace:"vspace",unselectable:"unselectable",disabled:"disabled",readonly:"readonly",selected:"selected",autoComplete:"autocomplete",tagGuid:"taguid",tagMultiGuid:"taguids",tagName:"tagname",tagKeywords:"keywords",tagWebLink:"weblink",tagPosX:"posx",tagPosY:"posy",tagOwnerId:"ownerid",tagHover:"taghover",fluidWidth:"fluidwidth",hiddenKey:"hiddenkey",imgLoaded:"loaded",orgText:"orgtext",isVisible:"isvis",guid:"guid"},names={formRegister:cssPrefix+"registerForm",formLogin:cssPrefix+"loginForm",formForgot:cssPrefix+"formForgot",formCreate:cssPrefix+"newTagForm",formSettings:cssPrefix+"formSettings",strFullName:"strFullName",strUsername:"strUsername",strPassword:"strPassword",strConfirmPass:"strConfirmPass",strWebName:"strWebName",strWebURL:"strWebURL",nTagID:"nTagID",strWebReferer:"strWebReferer",strImageURL:"strImageURL",strTagName:"strTagName",strKeywords:"strKeywords",strWebLink:"strWebLink",nPosX:"nPosX",nPosY:"nPosY",strComments:"strComments",btnRepositionTags:"btnRepositionTags",btnRemoveTags:"btnRemoveTags",btnOpenLightbox:"btnOpenLightbox"},types={button:"button",submit:"submit",text:"text",password:"password",hidden:"hidden",jstxt:"text/javascript",csstxt:"text/css"},events={submit:"submit",scroll:"scroll",click:"click",load:"load",unload:"unload",keyup:"keyup",focus:"focus",blur:"blur",change:"change",mouseover:"mouseover",mouseout:"mouseout",mousedown:"mousedown",mouseup:"mouseup",mousemove:"mousemove",touchstart:"touchstart",touchend:"touchend",selectstart:"selectstart",readystatechange:"readystatechange",domcontentloaded:"domcontentloaded"},html={script:"script",link:"link",head:"head",body:"body",h2:"h2",p:"p",a:"a",br:"br",em:"em",ol:"ol",li:"li",strong:"strong",img:"img",div:"div",span:"span",form:"form",input:"input",select:"select",option:"option",textarea:"textarea",label:"label",button:"button",canvas:"canvas"},serverKeys={user:{guid:"guid",tagTotal:"tagTotal",fullName:"fullName",isOwner:"isOwner"},tags:{guid:"strGUID",name:"strTagName",imagePath:"strImageURL",posX:"nPosX",posY:"nPosY",keywords:"arrKeywords",webLink:"strWebLink",ownerGuid:"nTaggerAccountsID"}},regex={csv:/[\s,]+/,ss:/\s/g,ltrim:/^\s\s*/,rtrim:/\s\s*$/,purl:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,query:/(?:^|&)([^&=]*)=?([^&]*)/g,nump:/[^0-9\.\-]+/g,camel:/-+(.) ?/g,tslash:/\/$/g,fext:/[^.]+$/,opacity:/^0.55$/,mobile:/android|webos|iphone|ipad|ipod|blackberry/i},globalVars.availableThemes={"default":825248,launch:469725,virgin:979253},globalVars.availableDotSizes={small:classes.tagSmall,medium:classes.tagMedium,large:classes.tagLarge},globalVars.tooltipOrientations={top:"top",right:"right",bottom:"bottom",left:"left"},globalVars.canvasDrawStyles={radial:"radial",linear:"linear",solid:"solid"},plib={onDomReady:function(a){var b=document.addEventListener?events.domcontentloaded:events.readystatechange,c=function(){plib.removeEvent(document,b),plib.removeEvent(window,events.load)};document.readyState!==readyStates.complete?(plib.addEvent(document,b,function(){document.readyState===readyStates.complete&&(c.call(),a.call())}),plib.addEvent(window,events.load,function(){c.call(),a.call()})):a.call()},loadScript:function(a,b){var c,d={},e=function(){plib.removeEvent(c,events.readystatechange),plib.removeEvent(c,events.load)};d[attributes.src]=a,d[attributes.type]=types.jstxt,c=plib.domAppend(html.script,document.getElementsByTagName(html.head)[0],d),plib.addEvent(c,events.readystatechange,function(){(c.readyState===readyStates.complete||c.readyState===readyStates.loaded)&&(e.call(),b(c))}),plib.addEvent(c,events.load,function(){e.call(),b(c)})},type:function(a){switch(a){case null:return NULL_TYPE;case void 0:return UNDEFINED_TYPE}var b=protoString.call(a);switch(b){case BOOLEAN_CLASS:return BOOLEAN_TYPE;case NUMBER_CLASS:return NUMBER_TYPE;case STRING_CLASS:return STRING_TYPE;case ARRAY_CLASS:return ARRAY_TYPE;case FUNCTION_CLASS:return FUNCTION_TYPE;case DATE_CLASS:return DATE_TYPE}return 1===a.nodeType?ELEMENT_TYPE:OBJECT_TYPE},isElement:function(a){return plib.type(a)===ELEMENT_TYPE},isNull:function(a){return plib.type(a)===NULL_TYPE},isUndefined:function(a){return plib.type(a)===UNDEFINED_TYPE},isBoolean:function(a){return plib.type(a)===BOOLEAN_TYPE},isNumber:function(a){return plib.type(a)===NUMBER_TYPE},isString:function(a){return plib.type(a)===STRING_TYPE},isObject:function(a){return plib.type(a)===OBJECT_TYPE},isFunction:function(a){return plib.type(a)===FUNCTION_TYPE},isArray:function(a){return plib.type(a)===ARRAY_TYPE},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},hasClass:function(a,b){return new RegExp("\\b"+b+"\\b").test(a.className)},addClass:function(a,b){plib.hasClass(a,b)||(a.className+=a.className?whiteSpace+b:b)},removeClass:function(a,b){var c=a.className.match(whiteSpace+b)?whiteSpace+b:b;a.className=a.className.replace(c,"")},getParentByClassName:function(a,b){for(;a&&!plib.hasClass(a,b);)a=a.parentNode||null;return a},getElementsByClassName:function(a,b){var c=[];return b=b||document.getElementsByTagName(html.body).item(0),plib.loopArray(b.getElementsByTagName(asterisk),function(b){plib.hasClass(b,a)&&c.push(b)}),c},hasProperty:function(a,b){var c=Object.prototype.hasOwnProperty,d="__proto__";return c?c.call(a,b):(d=a[d]||a.constructor.prototype,!plib.isUndefined(a[b])&&(plib.isUndefined(d[b])||d[b]!==a[b]))},loop:function(a,b){for(var c=0;a>c&&null!==b(c);)c++},rloop:function(a,b){for(;a--;)b(a)},loopArray:function(a,b){plib.loop(a.length,function(c){return 2===b.length?b(c,a[c]):b(a[c])})},loopObject:function(a,b){var c;for(c in a)if(1===b.length){if(null===b(a[c]))break}else if(2===b.length&&null===b(c,a[c]))break},loopObjectKeys:function(a,b){var c;for(c in a)if(null===b(c))break},isObjectEmpty:function(a){var b;for(b in a)if(plib.hasProperty(a,b))return!1;return!0},mergeObject:function(a,b){var c;for(c in b)a[c]=b[c];return a},cloneObject:function(a){var b={};return plib.isObject(a)?(plib.loopObject(a,function(a,c){b[a]=plib.cloneObject(c)}),b):a},getParamsFromObject:function(a){var b=[];return plib.loopObject(a,function(a,c){b[b.length]=encodeURIComponent(a)+"="+encodeURIComponent(c)}),b.join("&")},getEventTarget:function(a){var b;return a=a||window.event,b=a.target||a.srcElement,3===b.nodeType&&(b=b.parentNode),b},randomID:function(a){for(var b="",c=0,d="0123456789ABCDEFGHIJKLMNOPQURSTUVWXYZ";a>c;)b+=d.substr(Math.floor(Math.random()*d.length),1),c++;return b},getMousePosition:function(a){a=a||window.event;var b=document.documentElement,c=document.body,d={x:0,y:0};return a.pageX||a.pageY?(d.x=a.pageX,d.y=a.pageY):(d.x=a.clientX+(b.scrollLeft||c.scrollLeft)-b.clientLeft,d.y=a.clientY+(b.scrollTop||c.scrollTop)-b.clientTop),d},getWidth:function(a){var b=a.offsetWidth||a.clientWidth;return b||(plib.setStyle(a,css.visibility,"hidden"),plib.show(a),b=a.offsetWidth||a.clientWidth,plib.hide(a),plib.setStyle(a,css.visibility,"visible")),b||0},setWidth:function(a,b){plib.setStyle(a,css.width,b)},getHeight:function(a){var b=a.offsetHeight||a.clientHeight;return b||(plib.setStyle(a,css.visibility,"hidden"),plib.show(a),b=a.offsetHeight||a.clientHeight,plib.hide(a),plib.setStyle(a,css.visibility,"visible")),b||0},setHeight:function(a,b){plib.setStyle(a,css.height,b)},getCumulativeOffset:function(a){var b={x:0,y:0};if(a.offsetParent)do b.x+=a.offsetLeft,b.y+=a.offsetTop,a=a.offsetParent;while(a);return b},attribute:function(a,b,c){var d=a.nodeType;return a&&3!==d&&8!==d&&2!==d?plib.isObject(b)?void plib.loopObject(b,function(b,c){plib.attribute(a,b,c)}):plib.isUndefined(c)?a.getAttribute(b):null===c||c===!1?void("class"===b?plib.removeClass(a,c):a.removeAttribute(b)):("class"===b?plib.addClass(a,c):a.setAttribute(b,c),c):void 0},getGUID:function(a){var b;return a===window?b=splElmIds.window:a===document?b=splElmIds.document:(b=plib.attribute(a,attributes.guid),b||(b=plib.attribute(a,attributes.guid,plib.randomID(16)))),b},setStyles:function(a,b){plib.loopObject(b,function(b,c){plib.setStyle(a,b,c)})},setStyle:function(a,b,c){var d=a.style;if(b=b===css.cssFloat?support.cssFloat:b,d&&a&&3!==a.nodeType&&8!==a.nodeType){if(b===css.opacity)return void plib.setAlpha(a,c);plib.isNumber(c)&&!plib.inArray([css.zIndex,css.opacity],b)&&(c+=cssUnit),pfunc.attempt(function(){d[b]=c})}},getStyle:function(a,b,c){var d,e;return plib.isString(a)&&(c=b,b=a,a=void 0),b!==css.opacity||support.opacity?(c=c||plib.getComputedStyles(a),d=c[b]):(e=plib.getStyle(a,css.filter,c),d=e?parseFloat(e.replace(regex.nump,""))/100:null),"auto"===d?null:d},getComputedStyles:function(a){var b={},c=defaultView?defaultView.getComputedStyle(a,null):a.currentStyle,d=c.length,e=function(a){var d,e,f;plib.isUndefined(c.getPropertyValue)||(d=c.getPropertyValue(a)),d||(d=c[a]),d&&(e=plib.type(d),(plib.isNumeric(d)&&e!==NUMBER_TYPE||e===STRING_TYPE&&d.indexOf(cssUnit)>0)&&(f=parseFloat(d),isNaN(f)||(d=f)),b[plib.camelize(a)]=d)};return d?plib.loop(d,function(a){e(c[a])}):plib.loopObjectKeys(c,function(a){plib.hasProperty(c,a)&&e(a)}),b},camelize:function(a){return a.replace(regex.camel,function(a,b){return b?b.toUpperCase():""})},stopBubble:function(a){a=a||window.event,a.preventDefault?a.preventDefault():a.returnValue=!1,a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},removeChildren:function(a){if(a)for(;a.hasChildNodes();)plib.removeElement(a.firstChild)},cleanElement:function(a){var b=plib.getGUID(a);plib.removeAllEvents(a),plib.removeChildren(a),pfunc.removeAllKeyListeners(b),delete cacheElements[b]},removeElement:function(a){a&&(plib.cleanElement(a),a.parentNode&&a.parentNode.removeChild(a))},replaceElement:function(a,b){plib.cleanElement(a),plib.isString(b)&&(b=document.createTextNode(b)),a.parentNode&&a.parentNode.replaceChild(b,a)},insertBefore:function(a,b){return a.parentNode.insertBefore(b,a),b},insertAfter:function(a,b){return plib.isString(b)&&(b=document.createTextNode(b)),a.parentNode.insertBefore(b,plib.getNextSibling(a)),b},getNextSibling:function(a){do a=a.nextSibling;while(a&&1!==a.nodeType);return a},newElement:function(a,b,c){var d=document.createElement(a),e=plib.getGUID(d);return cacheElements[e]=d,b&&plib.isString(b)&&(c=c||b,b={}),b&&plib.isObject(b)&&plib.attribute(d,b),c&&plib.isString(c)&&plib.appendText(d,c),d},domAppend:function(a,b,c,d){var e,f;return c&&plib.isString(c)&&(d=d||c,c={}),plib.isString(a)&&(a=plib.newElement(a,c,d)),e=a.nodeType,f=b.nodeType,1!==e&&11!==e&&3!==e||1!==f&&11!==f&&3!==f||b.appendChild(a),a},domWrap:function(a,b,c,d){return c&&plib.isString(c)&&(d=d||c,c={}),plib.isString(a)&&(a=plib.newElement(a,c,d)),plib.isElement(a)&&plib.isElement(b)&&(b.parentNode.insertBefore(a,b),plib.domAppend(b,a)),a},isElementIn:function(a,b){for(;a;){if(a===b||a.nodeName.toLowerCase()===b)return!0;a=a.parentNode}return!1},isElementEmpty:function(a){return 0===a.children.length},parseHTML:function(a,b){var c,d=document.createDocumentFragment();return c=function(a){var d,e={};return plib.hasProperty(a,b.id)&&(e.id=a[b.id]),plib.hasProperty(a,b.className)&&(e["class"]=a[b.className]),plib.hasProperty(a,b.attr)&&plib.loopObject(a[b.attr],function(a,b){e[a]=b}),plib.hasProperty(a,b.nodeName)&&(d=plib.newElement(a[b.nodeName],e),a[b.childNodes]&&a[b.childNodes].length>0&&plib.loopArray(a[b.childNodes],function(a){plib.domAppend(c(a),d)})),a[b.text]&&a[b.text].length>0&&(d?plib.appendText(d,a[b.text]):d=document.createTextNode(a[b.text])),d},b=b||{nodeName:"nodeName",childNodes:"childNodes",className:"className",id:"id",attr:"attr",text:"text"},plib.isArray(a)?plib.loopArray(a,function(a){plib.domAppend(c(a),d)}):plib.isObject(a)&&plib.domAppend(c(a),d),d},replaceHTML:function(a,b){plib.removeChildren(a),plib.isString(b)?plib.appendText(a,b):a.appendChild(plib.parseHTML(b))},appendText:function(a,b){return b.length>0?a.appendChild(document.createTextNode(b)):void 0},textContentRecursive:function(a,b){for(;a;){if(!a.firstChild||!plib.isElement(a.firstChild))return b?plib.textContent(a,b):plib.textContent(a);a=a.firstChild}},textContent:function(a,b){var c,d,e;for(c=0,d=a.childNodes.length;d>c;c++)if(e=a.childNodes[c],3===e.nodeType)return b&&(e.nodeValue=b),e.nodeValue;return b?plib.appendText(a,b):""},disableSelection:function(a){plib.isUndefined(a.onselectstart)||(a.onselectstart=function(){return!1}),plib.addClass(a,classes.noSelect),plib.attribute(a,attributes.unselectable,"on")},show:function(a){a.style[css.display]="block"},hide:function(a){a.style[css.display]="none"},isVisible:function(a){var b=plib.getComputedStyles(a);return!("hidden"===plib.getStyle(css.visibility,b)||"none"===plib.getStyle(css.display,b)||0===plib.getStyle(css.opacity,b))},handleEvent:function(a){a=a||window.event,plib.stopBubble(a);var b=this,c=!0,d=b.events[a.type];return plib.loopObjectKeys(d,function(e){b.handleEvent=d[e],b.handleEvent(a)===!1&&(c=!1)}),c},hasEvent:function(a,b){var c=plib.getGUID(a);return!(!cacheEvents[c]||!cacheEvents[c][b])},addEvent:function(a,b,c){var d,e=plib.getGUID(a);return plib.hasEvent(a,b)?void pfunc.warn(messages.eventDuplicate,b,a):(cacheEvents[e]||(cacheEvents[e]={}),cacheEvents[e][b]={element:a,handler:c},void(a.addEventListener?a.addEventListener(b,c,!1):(c.guid||(c.guid=plib.randomID(12)),a.events||(a.events={}),d=a.events[b],d||(d=a.events[b]={},a[ieEventPrefix+b]&&(d[0]=a[ieEventPrefix+b])),d[c.guid]=c,a[ieEventPrefix+b]=plib.handleEvent)))},removeEvent:function(a,b){var c,d=plib.getGUID(a);plib.hasEvent(a,b)&&(c=cacheEvents[d][b].handler,delete cacheEvents[d][b],plib.isObjectEmpty(cacheEvents[d])&&delete cacheEvents[d],a.removeEventListener?a.removeEventListener(b,c,!1):a.events&&a.events[b]&&delete a.events[b][c.guid])},removeAllEvents:function(a){var b=plib.getGUID(a);cacheEvents[b]&&plib.loopObjectKeys(cacheEvents[b],function(b){plib.removeEvent(a,b)})},fireEvent:function(a,b){var c;plib.hasEvent(a,b)&&(document.createEvent?(c=document.createEvent("HTMLEvents"),c.initEvent(b,!0,!0),a.dispatchEvent(c)):(c=document.createEventObject(),c.eventType=ieEventPrefix+b,a.fireEvent(c.eventType,c)))},click:function(a,b,c){c=c||!1,b&&plib.addClass(a,classes.button),plib.addEvent(a,events.click,function(d){return plib.stopBubble(d),c&&(plib.removeEvent(a,events.click),plib.removeClass(a,classes.button)),b&&b.call(a,d),!1})},jsonpGarbageCollect:function(a){plib.removeElement(document.getElementById(a)),clearTimeout(jsonpTimeout[a]),delete jsonpTimeout[a],delete jsonpHandler[a]},loadJSONP:function(a,b,c){var d,e="JSONP_"+plib.randomID(12),f="",g=(new Date).getTime();b&&(plib.isFunction(b)?(c=b,b=""):plib.isObject(b)&&(f=plib.getParamsFromObject(b),f=f?"&"+f:"")),d=directory.paths.hub+"?r="+a+"&jsid="+e+"&pk="+globalVars.publicKey+f,settings.jsonpTimeout>0&&(jsonpTimeout[e]=setTimeout(function(){pfunc.error(messages.jsonpTimeout,d),c&&c(null,settings.jsonpTimeout),plib.jsonpGarbageCollect(e)},settings.jsonpTimeout)),jsonpHandler[e]=function(a){var b=(new Date).getTime()-g;c&&c(a,b),plib.jsonpGarbageCollect(e)},plib.domAppend(html.script,document.getElementsByTagName(html.head).item(0),{id:e,src:d,type:types.jstxt}),pfunc.log(messages.jsonp,d)},stopAnimation:function(a){a.animationMemory&&clearInterval(a.animationMemory)},animate:function(a,b,c,d,e){var f,g=[],h=(new Date).getTime(),i=function(b,c){var d={};d.cssProp=b,d.startValue=plib.getStyle(a,d.cssProp)||0,d.endValue=c,d.displacement=d.endValue-d.startValue,isNaN(d.startValue)||isNaN(d.endValue)||isNaN(d.displacement)||g.push(d)};plib.isObject(b)?(e=d,d=c,c=null,plib.loopObject(b,function(a,b){i(a,b)})):i(b,c),0!==g.length&&(f=Math.PI/(2*d),a.animationMemory&&plib.stopAnimation(a),a.animationMemory=setInterval(function(){var b=(new Date).getTime()-h,c=Math.abs(Math.sin(b*f));d>b?plib.loopArray(g,function(b){plib.setStyle(a,b.cssProp,c*b.displacement+b.startValue)}):(plib.stopAnimation(a),plib.loopArray(g,function(b){plib.setStyle(a,b.cssProp,b.endValue)}),e&&e.call(a))},10))},setAlpha:function(a,b){support.opacity?a.style[css.opacity]=b:a.style[css.filter]="alpha(opacity = "+String(100*b)+") "},fadeTo:function(a,b,c,d){plib.animate(a,css.opacity,b,c,d)},fadeIn:function(a,b,c){plib.fadeTo(a,1,b,c)},fadeOut:function(a,b,c){plib.fadeTo(a,0,b,c)},stripSpaces:function(a){return a.replace(regex.ss,"")},inArray:function(a,b){var c=!1;return plib.loopArray(a,function(a){return a===b?(c=!0,null):void 0}),c},arrayUnique:function(a){var b=[];return plib.loopArray(a,function(a){plib.inArray(b,a)||(b[b.length]=a)}),b},removeArrayItem:function(a,b){return plib.loopArray(a,function(c,d){d===b&&a.splice(c,1)}),a},parseUrl:function(a){for(var b=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],c="queryKey",d=regex.purl.exec(a),e={},f=14;f--;)e[b[f]]=d[f]||"";return e[c]={},e[b[12]].replace(regex.query,function(a,b,d){b&&(e[c][b]=d)}),e},getFileExtension:function(a){var b=a?plib.parseUrl(a).file:null,c=b?regex.fext.exec(b).pop():null;return c?c.toLowerCase():null},runInterval:function(a,b,c,d,e){var f,g=0;c.call()===!0?d.call():f=window.setInterval(function(){c.call()===!0?(clearInterval(f),d.call()):(g++,g>=b&&(window.clearInterval(f),e&&e.call()))},a)},stringFormat:function(a,b){var c=a;return plib.loopArray(b,function(a,b){var d=new RegExp("\\{"+a+"\\}","gi");c=c.replace(d,b)}),c}},commonHTML={buildForm:function(a,b,c){var d={};return b=[{nodeName:html.div,className:classes.formError}].concat(b),plib.isUndefined(c)||(b=b.concat([commonHTML.buildButton(c)])),d[attributes.name]=a,[{nodeName:html.form,id:a,className:classes.formStyle,attr:d,childNodes:b}]},buildFormInput:function(a,b){return{nodeName:html.input,attr:{type:a,name:b,autocomplete:"off"}}},buildFormTextArea:function(a){return{nodeName:html.textarea,attr:{name:a}}},buildFormSelect:function(a,b){var c=[];return plib.loopObject(b,function(a,b){c.push({nodeName:html.option,attr:{value:a},text:b})}),{nodeName:html.select,attr:{name:a},childNodes:c}},buildFormLabelSm:function(a,b){return commonHTML.buildFormLabel(a,b,!0)},buildFormLabel:function(a,b,c){var d={},e=c?classes.formLabelSm:classes.formLabel;return d[html.input]=classes.formTextField,d[html.textarea]=classes.formTextArea,d[html.select]=classes.formDropDown,{nodeName:html.label,className:e+whiteSpace+d[b.nodeName],text:a+":"+whiteSpace,childNodes:[{nodeName:html.span,childNodes:[b]}]}},buildHeader:function(a){return{nodeName:html.div,className:classes.windowHeader,childNodes:[{nodeName:html.a,className:classes.logo,text:sysName,attr:{href:directory.paths.website}},{nodeName:html.h2,className:classes.windowTitle,text:a}]}},buildButton:function(a,b){var c=classes.formBtnSubmit,d={type:types.button};return b&&(plib.isFunction(b)&&(b=b.call()),plib.hasProperty(b,attributes.className)&&(c=c+whiteSpace+b[attributes.className],delete b[attributes.className]),plib.isObjectEmpty(b)||plib.mergeObject(d,b)),{nodeName:html.button,className:c,childNodes:[{nodeName:html.span,childNodes:[{nodeName:html.span,text:a}]}],attr:d}},backToLogin:{nodeName:html.div,className:classes.formOptions,childNodes:[{nodeName:html.span,className:classes.formOption_backToLogin,text:"Back to Login"}]},logoutTab:[{nodeName:html.span,className:classes.windowLogout,text:"LOGOUT"},{nodeName:html.span,className:classes.windowUserName}],buildModal:function(a,b){return b=[{nodeName:html.a,className:classes.logo,attr:{href:directory.paths.website},text:sysName},{nodeName:html.h2,text:a}].concat(b),{nodeName:html.div,className:classes.modalMsg,childNodes:b}},simpleAdd:function(a,b){return{nodeName:a,text:b}}},layout={formTagCreate:commonHTML.buildForm(names.formCreate,commonHTML.logoutTab.concat([commonHTML.buildHeader("ADD NEW TAG"),commonHTML.buildFormInput(types.hidden,names.strWebReferer),commonHTML.buildFormInput(types.hidden,names.strImageURL),commonHTML.buildFormInput(types.hidden,names.nPosX),commonHTML.buildFormInput(types.hidden,names.nPosY),commonHTML.buildFormLabel("Tag name",commonHTML.buildFormInput(types.text,names.strTagName)),commonHTML.buildFormLabel("Keywords",commonHTML.buildFormInput(types.text,names.strKeywords)),commonHTML.buildFormLabel("Destination url",commonHTML.buildFormInput(types.text,names.strWebLink))]),"SAVE & PUBLISH TAG"),formRegister:commonHTML.buildForm(names.formRegister,[commonHTML.buildHeader("ACCOUNT REGISTRATION"),commonHTML.buildFormLabel("Full Name",commonHTML.buildFormInput(types.text,names.strFullName)),commonHTML.buildFormLabel("E-mail",commonHTML.buildFormInput(types.text,names.strUsername)),commonHTML.buildFormLabel("Password",commonHTML.buildFormInput(types.password,names.strPassword)),commonHTML.buildFormLabel("Confirm Pass",commonHTML.buildFormInput(types.password,names.strConfirmPass)),commonHTML.buildHeader("SITE REGISTRATION"),commonHTML.simpleAdd(html.p,"For "+sysName+" to work securely, it requires users to link their website to their account. Please provide us with some basic information about your website."),commonHTML.buildFormLabel("Website Name",commonHTML.buildFormInput(types.text,names.strWebName)),commonHTML.buildFormLabel("Website Domain",commonHTML.buildFormInput(types.text,names.strWebURL)),commonHTML.backToLogin],"REGISTER"),formLogin:commonHTML.buildForm(names.formLogin,[commonHTML.buildHeader("ACCOUNT LOGIN"),commonHTML.buildFormLabel("E-mail",commonHTML.buildFormInput(types.text,names.strUsername)),commonHTML.buildFormLabel("Password",commonHTML.buildFormInput(types.password,names.strPassword)),{nodeName:html.div,className:classes.formOptions,childNodes:[{nodeName:html.span,className:classes.formOption_forgotPass,text:"Forgot your password?"},{nodeName:html.span,className:classes.formOption_register,text:"Sign Up"}]}],"LOGIN"),formForgot:commonHTML.buildForm(names.formForgot,[commonHTML.buildHeader("FORGOT PASSWORD"),commonHTML.buildFormLabel("E-mail",commonHTML.buildFormInput(types.text,names.strUsername)),commonHTML.backToLogin],"RETRIEVE PASSWORD"),formSettings:commonHTML.buildForm(names.formSettings,commonHTML.logoutTab.concat([commonHTML.buildHeader("UPDATE SETTINGS"),commonHTML.simpleAdd(html.p,"This form allows administrators to change how "+sysName+" interacts with images. This form is not accessible to the public."),commonHTML.buildButton("REPOSITION TAGS",function(){var a={};
return a[attributes.className]=classes.formBtnLeft,a[attributes.name]=names.btnRepositionTags,a}),commonHTML.buildButton("REMOVE TAGS",function(){var a={};return a[attributes.className]=classes.formBtnLeft,a[attributes.name]=names.btnRemoveTags,a}),commonHTML.buildButton("OPEN IMAGES IN LIGHTBOX",function(){var a={};return a[attributes.className]=classes.formBtnLeft,a[attributes.name]=names.btnOpenLightbox,a})])),msgTagDeleted:commonHTML.buildModal("This tag has been deleted.",[commonHTML.simpleAdd(html.p,"Note: because you are either the owner of the image, or the tags creator, you are able to delete it whereas the public would only be able to report.")]),msgForgot:commonHTML.buildModal("You have requested a new password.",[commonHTML.simpleAdd(html.p,"A new password has been generated and sent to your email address. We recommend that you change it asap!")]),msgRegistered:commonHTML.buildModal("Registration was successful.",[commonHTML.simpleAdd(html.p,"You have just created your account! Easy right? However there is one last step: your email needs to be authenticated. Please check your inbox for a confirmation email. If you do not receive an email within the hour, please contact our support team.")]),msgNoPermission:commonHTML.buildModal("You do not have sufficient permission.",[commonHTML.simpleAdd(html.p,"The owner of this website has requested your account not be able to add or request tags. Please contact the site owner for more information.")]),msgImageDisabled:commonHTML.buildModal("This image has been disabled.",[commonHTML.simpleAdd(html.p,"The "+sysName+" interface will no longer show on this image. If you wish the enable the interface, you can do so in the settings window.")]),msgImageEnabled:commonHTML.buildModal("This image has been enabled.",[commonHTML.simpleAdd(html.p,"The "+sysName+" interface will now show on this image. If you wish the disabled the interface, you can do so in the settings window.")]),msgFirstTag:commonHTML.buildModal("This appears to be your first tag!",[commonHTML.simpleAdd(html.p,"Luckily for you, we have made it as easy as possible. Here are some simple instructions to get you started."),{nodeName:html.ol,childNodes:[{nodeName:html.li,text:"Click on the image where you would like the tag to appear."},{nodeName:html.li,text:"A popup form will obtain some information relevant to the tag."},{nodeName:html.li,text:"Click save and you're off to the races."}]},commonHTML.buildButton("GREAT, LET'S GET STARTED")]),confirmPrompt:{nodeName:html.div,className:classes.prompt,childNodes:[commonHTML.buildHeader("PLEASE CONFIRM"),{nodeName:html.p,className:classes.promptMessage},commonHTML.buildButton("YES I DO",{"class":classes.promptAccept}),commonHTML.buildButton("NO THANKS",{"class":classes.promptDeny})]}},PinUi.prototype={init:function(){var a=this,b=plib.domAppend(html.div,a.scope.privateElements.imgOverlay,{"class":classes.guiLeftHolder}),c=plib.domAppend(html.div,a.scope.privateElements.imgOverlay,{"class":classes.guiRightHolder}),d=plib.domAppend(html.span,c,{"class":classes.guiTopR+whiteSpace+classes.btnCancel});a.offsetLeft=plib.getWidth(b)-Math.abs(plib.getStyle(b,css.left)),a.offsetRight=10,plib.disableSelection(d),plib.addEvent(d,events.mouseover,function(){settings.animations?plib.animate(c,css.right,0,settings.navAniSpeed):plib.setStyle(c,css.right,0)}),plib.addEvent(d,events.mouseout,function(){settings.animations?plib.animate(c,css.right,-a.offsetRight,settings.navAniSpeed):plib.setStyle(c,css.right,-a.offsetRight)}),a.scope.privateElements.guiLeftHolder=b,a.scope.privateElements.guiRightHolder=c,a.scope.privateElements.btnCancel=d},ownerInit:function(){var a=this,b=plib.domAppend(html.span,a.scope.privateElements.imgOverlay,{"class":classes.btnSettings});plib.setAlpha(b,opacities.semi),plib.addEvent(b,events.mouseover,function(){settings.animations?plib.fadeTo(b,opacities.full,settings.navAniSpeed):plib.setAlpha(b,opacities.full)}),plib.addEvent(b,events.mouseout,function(){settings.animations?plib.fadeTo(b,opacities.semi,settings.navAniSpeed):plib.setAlpha(b,opacities.semi)}),plib.click(b,function(){pfunc.promptSettings(a.scope.image)}),a.scope.privateElements.btnSettings=b},check:function(){var a=this;a.allowPrivateInterfaces=a.hasOwnerPrivileges(),a.hasUi||a.build()},build:function(){var a=this;plib.loopArray(a.leftNavItems,function(b){if(!b.isPrivate||a.allowPrivateInterfaces){var c=plib.domAppend(html.span,a.scope.privateElements.guiLeftHolder,{"class":classes.guiBotL+whiteSpace+b.className},b.label);plib.disableSelection(c),pfunc.setFluidWidth(c),plib.addEvent(c,events.mouseover,function(){var b=plib.attribute(this,attributes.fluidWidth)-a.offsetLeft+5;settings.animations?plib.animate(this,css.left,b,settings.navAniSpeed):plib.setStyle(this,css.left,b)}),plib.addEvent(c,events.mouseout,function(){settings.animations?plib.animate(this,css.left,0,settings.navAniSpeed):plib.setStyle(this,css.left,0)}),plib.click(c,function(){b.event(a,c)})}}),a.allowPrivateInterfaces&&a.ownerInit(),a.hasUi=!0},destroy:function(){var a=this,b=plib.getElementsByClassName(classes.guiBotL,a.scope.privateElements.guiLeftHolder);b.length>0&&plib.loopArray(b,function(a){plib.removeElement(a)}),a.scope.privateElements.btnSettings&&plib.removeElement(a.scope.privateElements.btnSettings),a.hasUi=!1},enableCancelMode:function(a,b){var c=this,d=c.scope.privateElements.guiRightHolder,e=c.scope.privateElements.btnCancel,f=function(){c.disableCancelMode(b)};plib.click(e,f),pfunc.newKeyListener(keyCodes.esc,c.scope.pinUID,f),plib.textContent(e,a),plib.show(d),settings.animations&&plib.animate(d,css.right,-c.offsetRight,settings.navAniSpeed)},disableCancelMode:function(a){var b,c=this,d=c.scope.privateElements.guiRightHolder,e=c.scope.privateElements.btnCancel;plib.removeEvent(e,events.click),pfunc.removeKeyListener(keyCodes.esc,c.scope.pinUID),settings.animations?(b=pfunc.deactivateEvents(e,[events.mouseover,events.mouseout]),plib.animate(d,css.right,-plib.getWidth(d),settings.navAniSpeed,function(){pfunc.activateEvents(e,b),plib.hide(d),plib.removeChildren(e)})):(plib.hide(d),plib.removeChildren(e)),a&&a.call()},drawTooltip:function(a,b){var c,d,e,f=b.cornerRadius,g=b.pointerWidth,h=b.pointerHeight,i=b.canvasPadding,j=b.halfPixel,k=b.width,l=b.height,m=b.width-2*i-2*j,n=b.height-2*i-2*j,o=b.orientation,p=o===globalVars.tooltipOrientations.bottom?h:0,q=o===globalVars.tooltipOrientations.right?g:0,r=function(a){return Math.PI/180*a},s={top:h/2,right:g/2,bottom:h/2,left:g/2},t={topLeft:!0,topRight:!0,bottomLeft:!0,bottomRight:!0};o===globalVars.tooltipOrientations.top||o===globalVars.tooltipOrientations.bottom?(e=m/2,l+=h,b.offsetLeft<k/2?(e=b.offsetLeft-i,b.offsetLeft-i-f<g/2&&(s.left=0,t.topLeft=o===globalVars.tooltipOrientations.bottom?!1:!0,t.bottomLeft=o===globalVars.tooltipOrientations.top?!1:!0)):b.offsetRight<k/2&&(e=k-b.offsetRight-i,b.offsetRight-i-f<g/2&&(s.right=0,t.topRight=o===globalVars.tooltipOrientations.bottom?!1:!0,t.bottomRight=o===globalVars.tooltipOrientations.top?!1:!0))):(o===globalVars.tooltipOrientations.left||o===globalVars.tooltipOrientations.right)&&(e=n/2,k+=g),0>=f&&(t.topLeft=!1,t.topRight=!1,t.bottomLeft=!1,t.bottomRight=!1),a.width=k,a.height=l,plib.setWidth(a,k),plib.setHeight(a,l),c=pfunc.getCanvasContext(a,"2d"),c.translate(i+q+j,i+p+j),c.beginPath(),t.topLeft?(c.moveTo(0,f),c.arc(f,f,f,r(180),r(270),!1)):c.moveTo(0,0),o===globalVars.tooltipOrientations.bottom&&(c.lineTo(e-s.left,0),c.lineTo(e,-h),c.lineTo(e+s.right,0)),t.topRight?(c.lineTo(m-f,0),c.arc(m-f,f,f,r(270),r(0),!1)):c.lineTo(m,0),o===globalVars.tooltipOrientations.left&&(c.lineTo(m,e-s.top),c.lineTo(m+g,e),c.lineTo(m,e+s.bottom)),t.bottomRight?(c.lineTo(m,n-f),c.arc(m-f,n-f,f,r(0),r(90),!1)):c.lineTo(m,n),o===globalVars.tooltipOrientations.top&&(c.lineTo(e+s.right,n),c.lineTo(e,n+h),c.lineTo(e-s.left,n)),t.bottomLeft?c.arc(f,n-f,f,r(90),r(180),!1):c.lineTo(0,n),o===globalVars.tooltipOrientations.right&&(c.lineTo(0,e+s.bottom),c.lineTo(-g,e),c.lineTo(0,e-s.top)),c.closePath(),b.allowShadow&&(c.shadowColor=b.theme.shadowColor,c.shadowOffsetX=b.theme.shadowOffsetX,c.shadowOffsetY=b.theme.shadowOffsetY,c.shadowBlur=b.theme.shadowBlur),b.theme.backgroundStyle===globalVars.canvasDrawStyles.radial?(d=c.createRadialGradient(m/2,n/2,0,m/2,n/2,m>n?m:n),plib.loopArray(b.theme.backgroundColor.split(" "),function(a){var b=a.split("-");d.addColorStop(b[0],b[1])})):b.theme.backgroundStyle===globalVars.canvasDrawStyles.linear?(d=c.createLinearGradient(m/2,0,m/2,n),plib.loopArray(b.theme.backgroundColor.split(" "),function(a){var b=a.split("-");d.addColorStop(b[0],b[1])})):b.theme.backgroundStyle===globalVars.canvasDrawStyles.solid&&(d=b.theme.backgroundColor),c.fillStyle=d,c.fill(),b.allowStroke&&(b.allowShadow&&(c.shadowColor=null,c.shadowOffsetX=null,c.shadowOffsetY=null,c.shadowBlur=null),c.strokeStyle=b.theme.strokeColor,c.lineWidth=b.theme.strokeWidth,c.stroke())},hasOwnerPrivileges:function(){return!!userInfo[serverKeys.user.isOwner]},show:function(a){var b=this,c=b.scope.privateElements.guiLeftHolder,d=b.scope.privateElements.btnSettings,e=b.offsetLeft-plib.getWidth(c);b.isHidden=!1,a=a||!0,settings.animations&&a?(plib.show(c),plib.animate(c,css.left,e,settings.navAniSpeed),d&&(plib.show(d),plib.fadeTo(d,opacities.semi,settings.navAniSpeed))):(plib.setStyle(c,css.left,e),d&&plib.show(d))},hide:function(a){var b=this,c=b.scope.privateElements.guiLeftHolder,d=b.scope.privateElements.btnSettings,e=-plib.getWidth(c),f=[];b.isHidden=!0,a=a||!0,settings.animations&&a?(d&&(f[0]=pfunc.deactivateEvents(d,[events.mouseover,events.mouseout]),plib.fadeOut(d,settings.navAniSpeed,function(){pfunc.activateEvents(d,f[0]),plib.hide(d)})),f[1]=pfunc.deactivateEvents(c,[events.mouseover,events.mouseout]),plib.animate(c,css.left,e,settings.navAniSpeed,function(){pfunc.activateEvents(c,f[1]),plib.hide(c)}),plib.loopArray(c.children,function(a){var b=f.length++;f[b]=pfunc.deactivateEvents(a,[events.mouseover,events.mouseout]),plib.animate(a,css.left,0,settings.navAniSpeed,function(){pfunc.activateEvents(a,f[b])})})):(plib.setStyle(c,css.left,e),d&&plib.hide(d))},toggle:function(a){this.isHidden?this.show(a):this.hide(a)}},PinInst.prototype={destroy:function(a){var b=this;a?plib.removeElement(b.privateElements.imgNode):plib.replaceElement(b.privateElements.imgNode,b.imageClone),delete cacheNodes[b.uid],delete cacheImages[b.uid],delete cacheTags[b.uid],pfunc.info(messages.imageUnloaded,b.uid)},init:function(){var a,b=this,c=plib.getComputedStyles(b.image),d=oNamespace.checkImage+b.imageCloneSrc;plib.attribute(b.image,attributes.imgLoaded,strBool[1]),plib.addClass(b.image,classes.image),b.privateElements.imgNode=plib.domWrap(html.div,b.image,{"class":classes.node}),"inline"===c[css.display]&&plib.addClass(b.privateElements.imgNode,classes.inlineNode),cacheNodes[b.uid]={instance:b,imgGUID:plib.getGUID(b.image)},plib.click(b.privateElements.imgNode),b.settings.cssHelper&&b.styleHelper(c),plib.setWidth(b.image,b.dimensions.width),plib.setHeight(b.image,b.dimensions.height),plib.setStyle(b.image,css.maxWidth,b.dimensions.width),plib.setStyle(b.image,css.maxHeight,b.dimensions.height),plib.attribute(b.image,attributes.width,null),plib.attribute(b.image,attributes.height,null),plib.setWidth(b.privateElements.imgNode,b.dimensions.width),plib.setHeight(b.privateElements.imgNode,b.dimensions.height),b.settings.posHelper&&b.positionHelper(),b.privateElements.sectionBody=plib.domWrap(html.div,b.image,{"class":classes.sectionBody}),plib.setWidth(b.privateElements.sectionBody,b.dimensions.width),plib.setHeight(b.privateElements.sectionBody,b.dimensions.height),b.privateElements.imgOverlay=plib.domAppend(html.div,b.privateElements.sectionBody,{"class":classes.overlay}),plib.setWidth(b.privateElements.imgOverlay,b.dimensions.width),plib.setHeight(b.privateElements.imgOverlay,b.dimensions.height),b.privateElements.imgTagHolder=plib.domAppend(html.div,b.privateElements.imgOverlay,{"class":classes.tagHolder}),b.preRun(),a=pfunc.getLocalStorage(d),a?(b.imageSrc=a,b.imageCloneSrc!==b.imageSrc&&pfunc.info(messages.imageNewSrc,b.imageCloneSrc,b.imageSrc),b.postRun()):plib.loadJSONP(directory.names.checkImage,{strImageURL:b.imageSrc},function(a){a&&(b.imageSrc=a,pfunc.info(messages.imageNewSrc,b.imageCloneSrc,b.imageSrc)),pfunc.setLocalStorage(d,b.imageSrc),b.postRun()})},positionHelper:function(){var a=this,b=plib.getCumulativeOffset(a.image),c=plib.getStyle(a.privateElements.imgNode,css.position),d="absolute"===c?{top:css.top,left:css.left}:{top:css.margin.top,left:css.margin.left},e=plib.getStyle(a.privateElements.imgNode,d.left)||0,f=plib.getStyle(a.privateElements.imgNode,d.top)||0,g=a.dimensions.offsetLeft-b.x+e,h=a.dimensions.offsetTop-b.y+f;g>0&&(plib.setStyle(a.privateElements.imgNode,d.left,g),a.dimensions.offsetLeft=g),h>0&&(plib.setStyle(a.privateElements.imgNode,d.top,h),a.dimensions.offsetTop=h)},styleHelper:function(a){var b,c,d=this;delete a[css.display],"static"===a[css.position]&&delete a[css.position],plib.attribute(d.image,attributes.style,null),plib.attribute(d.image,attributes.align,null),plib.attribute(d.image,attributes.hspace,null),plib.attribute(d.image,attributes.vspace,null),b=plib.getComputedStyles(d.privateElements.imgNode),c=plib.getComputedStyles(d.image),plib.loopObject(a,function(a,e){if(!plib.inArray(["width","height","color"],a)){var f=b[a],g=c[a];e!==f&&plib.setStyle(d.privateElements.imgNode,a,e),g!==f&&plib.setStyle(d.image,a,f)}})},preRun:function(){var a=this;a.settings.allowBottomLinks===!0&&(a.privateElements.sectionFooter=plib.domAppend(html.div,a.privateElements.imgNode,{"class":classes.sectionFooter}),a.privateElements.linkHolder=plib.domAppend(html.div,a.privateElements.sectionFooter,{"class":classes.linkHolder}),plib.domAppend(html.div,a.privateElements.sectionFooter,{"class":classes.linkHolderBackground}),plib.hide(a.privateElements.sectionFooter)),a.ui=new PinUi(a),a.ui.init(),plib.addEvent(a.privateElements.imgNode,events.mouseover,function(b){new pfunc.MouseBoundaryCrossing(b,this).enteredLandmark&&a.enableImgNode()}),plib.addEvent(a.privateElements.imgNode,events.mouseout,function(b){new pfunc.MouseBoundaryCrossing(b,this).leftLandmark&&a.disableImgNode()}),a.settings.alwaysShowTags&&plib.addClass(a.privateElements.imgNode,classes.actionOn)},postRun:function(){var a=this;pfunc.log(messages.instOutput,a),a.settings.alwaysShowTags&&pfunc.checkLogin(null,null,function(){pfunc.methodSessionChange(a)})},methodAddNewTag:function(a){var b=this;pfunc.openPrivateWindow(layout.formTagCreate,function(){var c=document.forms[names.formCreate];c.elements[names.strWebReferer].value=windowLocation,c.elements[names.strImageURL].value=b.imageSrc,c.elements[names.nPosX].value=a.x,c.elements[names.nPosY].value=a.y,pfunc.manageTagSuggestionList(c),pfunc.manageKeywords(c.elements[names.strKeywords]),pfunc.validWebUrl(c.elements[names.strWebLink]),pfunc.manageFormSubmit(c,directory.names.tagCreate,[asterisk],function(a){a?pfunc.displayFormError(this,a):(pfunc.closeWindow(),b.updateNode(!0,!0),userInfo[serverKeys.user.tagTotal]+=1)})})},updateNode:function(a,b){var c=this,d=function(){var a=cacheTagData[this.imageSrc][0],b=cacheTagData[this.imageSrc][1];this.tagsVersion=a,b&&!plib.isObjectEmpty(b)&&(this.drawTagData(b),this.settings.allowBottomLinks&&this.drawLinkData(b))};if(a|=!1,b|=!1,c.updateInProgress!==!0)if(c.updateInProgress=!0,b&&delete cacheTagData[c.imageSrc],plib.hasProperty(cacheTagData,c.imageSrc))(a||c.tagsVersion!==cacheTagData[c.imageSrc][0])&&d.call(c),c.updateInProgress=!1;else{if(plib.hasProperty(queueTagData,c.uid)||(queueTagData[c.uid]=[]),plib.inArray(queueTagData[c.uid],c)||queueTagData[c.uid].push(c),queueTagData[c.uid].length>1)return;plib.loadJSONP(directory.names.getTags,{strImageURL:c.imageSrc},function(a){null!==a&&(cacheTagData[c.imageSrc]=[(new Date).getTime(),a],plib.loopArray(queueTagData[c.uid],function(a){d.call(a)}),delete queueTagData[c.uid]),c.updateInProgress=!1})}},tagMouseoverEvent:function(a){var b,c,d=this,e=plib.getElementsByClassName(classes.tagDot,a)[0],f=plib.getElementsByClassName(classes.tagOutline,a)[0],g=plib.getElementsByClassName(classes.tagBubble,a)[0],h={};plib.attribute(a,attributes.tagHover,strBool[1]),plib.setStyle(a,css.zIndex,999),plib.setStyle(d.privateElements.imgTagHolder,css.zIndex,999),e&&f&&(plib.show(f),b=2*d.settings.dotOutlineSize+plib.getWidth(e),h[css.width]=b,h[css.height]=b,h[css.margin.top]=-Math.floor(b/2),h[css.margin.left]=-Math.floor(b/2),settings.animations?plib.animate(f,h,200):plib.setStyles(f,h)),g&&d.allowTagBubble&&plib.show(g),c=pfunc.getTagGuidObject(a),c&&plib.loadJSONP(directory.names.logTagHover,c)},tagMouseoutEvent:function(a){var b=this,c=plib.getElementsByClassName(classes.tagOutline,a)[0],d=plib.getElementsByClassName(classes.tagBubble,a)[0],e={};plib.attribute(a,attributes.tagHover,null),plib.setStyle(a,css.zIndex,1),plib.setStyle(b.privateElements.imgTagHolder,css.zIndex,1),c&&(e[css.width]=0,e[css.height]=0,e[css.margin.top]=0,e[css.margin.left]=0,settings.animations?plib.animate(c,e,600,function(){plib.hide(this)}):(plib.setStyles(c,e),plib.hide(c))),d&&plib.hide(d)},clearTagData:function(){plib.loopObjectKeys(cacheTagData,function(a){delete cacheTagData[a]})},drawTagData:function(a){var b=this,c=plib.isElementEmpty(b.privateElements.imgTagHolder);plib.removeChildren(b.privateElements.imgTagHolder),plib.setAlpha(b.privateElements.imgTagHolder,0),plib.loopObject(a,function(a){function c(){plib.loopObjectKeys(cacheTags,function(a){console.log(a)})}var d,e,f,g,h,i,j,k=a[0],l=plib.randomID(12),m=25,n=[];i={},i[attributes.id]=tagPrefix+b.uid+"-"+l,i[attributes.className]=classes.tag+whiteSpace+globalVars.availableDotSizes[settings.dotSize],i[attributes.tagPosX]=k[serverKeys.tags.posX],i[attributes.tagPosY]=k[serverKeys.tags.posY],a.length>1?(plib.loopObject(a,function(a){n.push(a[serverKeys.tags.guid])}),i[attributes.tagMultiGuid]=n.join("_")):i[attributes.tagGuid]=k[serverKeys.tags.guid],d=plib.domAppend(html.div,b.privateElements.imgTagHolder,i),plib.setStyle(d,css.left,String(100*k[serverKeys.tags.posX])+"%"),plib.setStyle(d,css.top,String(100*k[serverKeys.tags.posY])+"%"),i={},i[attributes.className]=classes.tagDot,e=plib.domAppend(html.a,d,i),pfunc.setWindowLink(e,directory.paths.webloc+k[serverKeys.tags.guid]),b.settings.dotOutlineSize>0&&(i={},i[attributes.className]=classes.tagOutline,f=plib.domAppend(html.span,d,i),j={},j[css.width]=0,j[css.height]=0,j[css.margin.top]=0,j[css.margin.left]=0,plib.setStyles(f,j)),b.settings.tooltip&&(h=document.createDocumentFragment(),plib.hasProperty(cacheTags,b.uid)||(cacheTags[b.uid]={}),plib.loopArray(a,function(c,d){var e,f,g,j=d[serverKeys.tags.name],k=d[serverKeys.tags.keywords].join(),n=d[serverKeys.tags.webLink],o=d[serverKeys.tags.guid],p=d[serverKeys.tags.ownerGuid];cacheTags[b.uid][o]=l,i={},i[attributes.id]=tagPrefix+l+"-"+o,i[attributes.className]=classes.tagLink,i[attributes.tagGuid]=o,i[attributes.tagName]=j,i[attributes.tagKeywords]=k,i[attributes.tagWebLink]=n,i[attributes.tagOwnerId]=p,e=plib.domAppend(html.span,h,i),g=j.length>m?j.substr(0,m)+ellipsis:j,i={},i[attributes.className]=classes.tagLinkText,f=plib.domAppend(html.a,e,i,g),pfunc.setWindowLink(f,directory.paths.webloc+o),b.settings.tooltipURL&&(plib.loopArray(webProtos,function(a){n=n.replace(a,"")}),n=n.replace(regex.tslash,""),n.length>m&&(n=n.substr(0,m)+ellipsis),i={},i[attributes.className]=classes.tagLinkURL,plib.domAppend(html.span,e,i,n)),b.settings.allowShare&&(i={},i[attributes.className]=classes.tagLinkLike,plib.click(plib.domAppend(html.span,e,i,"like"),function(){b.manageTagLike(this)}),plib.setStyle(e,css.padding.right,18)),c+1===a.length&&plib.addClass(e,classes.lastItem)}),g=b.drawTagBubble(d,h),plib.hide(g)),c(),pfunc.isMobile()?plib.addEvent(d,events.touchend,function(){var a=plib.getParentByClassName(this,classes.tag);plib.stopBubble(),plib.attribute(a,attributes.tagHover)===strBool[1]?b.tagMouseoutEvent(a):b.tagMouseoverEvent(a)}):(plib.addEvent(d,events.mouseover,function(a){var c=plib.getParentByClassName(this,classes.tag);new pfunc.MouseBoundaryCrossing(a,this).enteredLandmark&&b.tagMouseoverEvent(c)}),plib.addEvent(d,events.mouseout,function(a){var c=plib.getParentByClassName(this,classes.tag);new pfunc.MouseBoundaryCrossing(a,this).leftLandmark&&b.tagMouseoutEvent(c)}))}),c?plib.fadeIn(b.privateElements.imgTagHolder,800):plib.setAlpha(b.privateElements.imgTagHolder,1)},drawTagBubble:function(a,b){var c,d,e,f,g=this,h=plib.getElementsByClassName(classes.tagDot,a)[0],i={},j={},k={},l=g.settings.tooltipOrientation;return e={},e[attributes.className]=classes.tagBubble,c=plib.domAppend(html.span,a,e),e={},e[attributes.className]=classes.tagBubbleContent,d=plib.domAppend(html.span,c,e),plib.domAppend(b,d),i.t=plib.getCumulativeOffset(a),i.th=plib.getCumulativeOffset(g.privateElements.imgTagHolder),j.halfPixel=g.settings.canvas.stroke&&g.settings.canvas.theme.strokeWidth%2!==0?.5:0,j.bubblePadding=3,j.bubbleDotDist=plib.getWidth(h)/2,j.tagBubbleWidth=plib.getWidth(c)+2*j.halfPixel,j.tagBubbleHeight=plib.getHeight(c)+2*j.halfPixel,j.tagHolderWidth=plib.getWidth(g.privateElements.imgTagHolder),j.tagHolderHeight=plib.getHeight(g.privateElements.imgTagHolder),j.tagBubbleContentHeight=plib.getHeight(d),j.tagOffsetTop=i.t.y-i.th.y,j.tagOffsetBottom=j.tagHolderHeight-j.tagOffsetTop,j.tagOffsetLeft=i.t.x-i.th.x,j.tagOffsetRight=j.tagHolderWidth-j.tagOffsetLeft,j.tailWidth=g.settings.canvas.tailWidth,j.tailHeight=g.settings.canvas.tailHeight,j.totalWidth=j.tagBubbleWidth,j.totalHeight=j.tagBubbleHeight,k[css.top]="auto",k[css.right]="auto",k[css.bottom]="auto",k[css.left]="auto",l===globalVars.tooltipOrientations.top||l===globalVars.tooltipOrientations.bottom?(k[css.left]=-(j.tagBubbleWidth/2),j.totalHeight+=j.tailHeight):(l===globalVars.tooltipOrientations.left||l===globalVars.tooltipOrientations.right)&&(j.tailWidth=g.settings.canvas.tailHeight,j.tailHeight=g.settings.canvas.tailWidth,k[css.top]=-(j.tagBubbleHeight/2),j.totalWidth+=j.tailWidth),l===globalVars.tooltipOrientations.top?j.totalHeight+j.bubbleDotDist>j.tagOffsetTop&&(l=globalVars.tooltipOrientations.bottom):l===globalVars.tooltipOrientations.right?j.totalWidth+j.bubbleDotDist>j.tagOffsetRight&&(l=globalVars.tooltipOrientations.left):l===globalVars.tooltipOrientations.bottom?j.totalHeight+j.bubbleDotDist>j.tagOffsetBottom&&(l=globalVars.tooltipOrientations.top):l===globalVars.tooltipOrientations.left&&j.totalWidth+j.bubbleDotDist>j.tagOffsetLeft&&(l=globalVars.tooltipOrientations.right),l===globalVars.tooltipOrientations.top?k[css.bottom]=j.bubbleDotDist:l===globalVars.tooltipOrientations.right?(k[css.left]=j.bubbleDotDist+1,plib.setStyle(d,css.padding.left,10+j.tailWidth)):l===globalVars.tooltipOrientations.bottom?(k[css.top]=j.bubbleDotDist+1,plib.setStyle(d,css.top,j.totalHeight-j.tagBubbleContentHeight)):l===globalVars.tooltipOrientations.left&&(k[css.right]=j.bubbleDotDist,plib.setStyle(d,css.padding.right,10+j.tailWidth)),(l===globalVars.tooltipOrientations.top||l===globalVars.tooltipOrientations.bottom)&&(j.tagOffsetLeft<j.tagBubbleWidth/2?k[css.left]=-j.tagOffsetLeft:j.tagOffsetRight<j.tagBubbleWidth/2&&(k[css.left]=-(j.tagBubbleWidth-j.tagOffsetRight))),plib.setStyles(c,k),plib.setWidth(c,j.totalWidth),plib.setHeight(c,j.totalHeight),plib.runInterval(30,30,function(){return support.canvas},function(){e={},e[attributes.className]=classes.tagBubbleCanvas,f=plib.domAppend(html.canvas,c,e),f.pinupCanvasProperties={theme:g.settings.canvas.theme,allowStroke:g.settings.canvas.stroke,allowShadow:g.settings.canvas.shadow,cornerRadius:g.settings.canvas.cornerRadius,canvasPadding:j.bubblePadding,halfPixel:j.halfPixel,width:j.tagBubbleWidth,height:j.tagBubbleHeight,offsetLeft:j.tagOffsetLeft,offsetRight:j.tagOffsetRight,pointerWidth:j.tailWidth,pointerHeight:j.tailHeight,orientation:l},g.ui.drawTooltip(f,f.pinupCanvasProperties)},function(){}),c},drawLinkData:function(a){var b=this,c=b.privateElements.linkHolder,d=function(){var a=plib.attribute(this,attributes.tagGuid);plib.hasProperty(cacheTags,b.uid)&&plib.hasProperty(cacheTags[b.uid],a)&&b.tagMouseoverEvent(document.getElementById(tagPrefix+b.uid+"-"+cacheTags[b.uid][a]))},e=function(){plib.loopArray(plib.getElementsByClassName(classes.tag,b.privateElements.imgTagHolder),function(a){b.tagMouseoutEvent(a)})};plib.removeChildren(c),plib.loopObject(a,function(a){plib.loopArray(a,function(a){var f,g;g={},g[attributes.className]=classes.link,g[attributes.tagGuid]=a[serverKeys.tags.guid],f=plib.domAppend(html.a,c,g),pfunc.setWindowLink(f,directory.paths.webloc+a[serverKeys.tags.guid]),g={},g[attributes.className]=classes.iconLabel,plib.domAppend(html.span,f,g),plib.appendText(f,a[serverKeys.tags.name]),b.settings.tooltip&&(plib.addEvent(f,events.mouseover,d),plib.addEvent(f,events.mouseout,e))})}),plib.isElementEmpty(c)?(plib.hide(b.privateElements.sectionFooter),plib.hide(c),plib.setHeight(b.privateElements.imgNode,b.dimensions.height)):(plib.show(b.privateElements.sectionFooter),plib.show(c),plib.setHeight(b.privateElements.imgNode,plib.getHeight(c)+b.dimensions.height))},enableImgNode:function(){var a=this;a.disallowNodeUpdate||(a.settings.alwaysShowTags||plib.addClass(a.privateElements.imgNode,classes.actionOn),pfunc.checkLogin(null,null,function(){pfunc.methodSessionChange(a)}),pfunc.newKeyListener(keyCodes.f2,a.uid,function(){a.ui.toggle()}))},disableImgNode:function(){var a=this;a.disallowNodeUpdate||(a.settings.alwaysShowTags||plib.removeClass(a.privateElements.imgNode,classes.actionOn),pfunc.removeKeyListener(keyCodes.f2,a.uid))},resetTagDotBehavior:function(){var a=this;plib.loopArray(plib.getElementsByClassName(classes.tagDot,a.privateElements.imgTagHolder),function(a){var b=pfunc.getTagGuidObject(a.parentNode),c=b?plib.hasProperty(b,"tagGUID")?b.tagGUID:plib.hasProperty(b,"tagMultiGUID")?b.tagMultiGUID.split("_")[0]:void 0:void 0;plib.removeAllEvents(a),c&&pfunc.setWindowLink(a,directory.paths.webloc+c)})},stopTaggingMode:function(){var a=this;a.disallowNodeUpdate=!1,a.allowTagBubble=!0,plib.removeEvent(a.privateElements.imgTagHolder,events.click),plib.removeClass(a.privateElements.imgTagHolder,classes.button),a.resetTagDotBehavior(),a.ui.show(),a.ui.disableCancelMode(),plib.removeClass(a.privateElements.imgNode,classes.taggingMode),plib.hasClass(globalElements.pInstWrapper,classes.actionShowWin)||plib.addClass(a.privateElements.imgNode,classes.actionOn)},startTaggingMode:function(a){var b=this;pfunc.checkPermission(function(){b.disallowNodeUpdate=!0,b.allowTagBubble=!1,plib.removeClass(b.privateElements.imgNode,classes.actionOn),plib.addClass(b.privateElements.imgNode,classes.taggingMode),plib.click(b.privateElements.imgTagHolder,function(c){b.stopTaggingMode(),a&&a.call(b,pfunc.getPosPercentage(c))},!0),plib.loopArray(plib.getElementsByClassName(classes.tagDot,b.privateElements.imgTagHolder),function(c){plib.removeAllEvents(c),plib.click(c,function(){b.stopTaggingMode(),a&&a.call(b,{x:plib.attribute(this.parentNode,attributes.tagPosX),y:plib.attribute(this.parentNode,attributes.tagPosY)})},!0)}),b.ui.hide(),b.ui.enableCancelMode("CANCEL",function(){b.stopTaggingMode()})})},stopTagRepositionMode:function(){var a=this;a.disallowNodeUpdate=!1,a.allowTagBubble=!0,plib.hasEvent(document,events.mouseup)&&(plib.fireEvent(document,events.mouseup),plib.removeEvent(document,events.mouseup),plib.removeClass(a.privateElements.imgNode,classes.handOver)),a.resetTagDotBehavior(),a.ui.show(),a.ui.disableCancelMode(),plib.removeClass(a.privateElements.imgNode,classes.repositionMode),plib.addClass(a.privateElements.imgNode,classes.actionOn)},startTagRepositionMode:function(){var a=this;pfunc.checkPermission(function(){a.disallowNodeUpdate=!0,a.allowTagBubble=!1,plib.removeClass(a.privateElements.imgNode,classes.actionOn),plib.addClass(a.privateElements.imgNode,classes.repositionMode),plib.loopArray(plib.getElementsByClassName(classes.tag,a.privateElements.imgTagHolder),function(b){var c=plib.getElementsByClassName(classes.tagDot,b)[0];plib.removeAllEvents(c),plib.addEvent(c,events.mouseover,function(){plib.addClass(a.privateElements.imgNode,classes.handOver)}),plib.addEvent(c,events.mouseout,function(){plib.removeClass(a.privateElements.imgNode,classes.handOver)}),plib.addEvent(c,events.mousedown,function(d){plib.stopBubble(d),plib.addClass(a.privateElements.imgNode,classes.handDrag),pfunc.startDragging(b),plib.addEvent(document,events.mouseup,function(){var d=pfunc.getTagGuidObject(c.parentNode);d&&(plib.removeClass(a.privateElements.imgNode,classes.handDrag),pfunc.stopDragging(b),plib.removeEvent(document,events.mouseup),d[serverKeys.tags.imagePath]=a.imageSrc,d[serverKeys.tags.posX]=plib.attribute(b,attributes.tagPosX),d[serverKeys.tags.posY]=plib.attribute(b,attributes.tagPosY),plib.loadJSONP(directory.names.tagPosition,d,a.clearTagData))})})}),a.ui.hide(),a.ui.enableCancelMode("DONE",function(){a.stopTagRepositionMode()})})},stopTagRemovalMode:function(){var a=this;a.disallowNodeUpdate=!1,a.allowTagBubble=!0,a.resetTagDotBehavior(),a.ui.show(),a.ui.disableCancelMode(),plib.removeClass(a.privateElements.imgNode,classes.removalMode),plib.addClass(a.privateElements.imgNode,classes.actionOn)},startTagRemovalMode:function(){var a=this;pfunc.checkPermission(function(){a.disallowNodeUpdate=!0,a.allowTagBubble=!1,plib.removeClass(a.privateElements.imgNode,classes.actionOn),plib.addClass(a.privateElements.imgNode,classes.removalMode),plib.loopArray(plib.getElementsByClassName(classes.tag,a.privateElements.imgTagHolder),function(b){var c=plib.getElementsByClassName(classes.tagDot,b)[0];plib.removeAllEvents(c),plib.click(c,function(){var b=plib.getElementsByClassName(classes.tagBubbleContent,c.parentNode)[0],d=b.children.length>1?messages.removeMultiTags:messages.removeTag;pfunc.promptConfirm(d,function(){var b=pfunc.getTagGuidObject(c.parentNode);b&&plib.loadJSONP(directory.names.tagRemove,b,function(d){plib.isUndefined(d)&&(pfunc.closeWindow(),plib.removeElement(c.parentNode),settings.allowBottomLinks&&(plib.hasProperty(b,"tagGUID")?plib.loopArray(a.privateElements.linkHolder.children,function(a){return plib.attribute(a,attributes.tagGuid)===b.tagGUID?(plib.removeElement(a),null):void 0}):plib.hasProperty(b,"tagMultiGUID")&&plib.loopArray(b.tagMultiGUID.split("_"),function(b){plib.loopArray(a.privateElements.linkHolder.children,function(a){return plib.attribute(a,attributes.tagGuid)===b?(plib.removeElement(a),null):void 0})})),a.clearTagData())})})})}),a.ui.hide(),a.ui.enableCancelMode("DONE",function(){a.stopTagRemovalMode()})})},manageTagLike:function(a){var b,c,d,e,f=this,g=plib.getParentByClassName(a,classes.tag),h=plib.getParentByClassName(a,classes.tagLink),i=plib.getElementsByClassName(classes.tagBubble,g)[0],j=plib.attribute(h,attributes.tagName),k=plib.attribute(h,attributes.tagWebLink);e={},e[attributes.className]=classes.shareHolder,b=plib.newElement(html.div,e),e={},e[attributes.className]=classes.shareHeader,c=plib.domAppend(html.span,b,e,"SHARE THIS ON"),e={},e[attributes.className]=classes.shareButtons,d=plib.domAppend(html.div,b,e),e={},e[attributes.className]=classes.shareButton+whiteSpace+"st_twitter_large",e[attributes.href]=directory.paths.twitter+plib.getParamsFromObject({text:j+" found at ",url:encodeURI(k)}),plib.click(plib.domAppend(html.a,d,e),function(){pfunc.openPopupWindow(plib.attribute(this,attributes.href),480,400)}),e={},e[attributes.className]=classes.shareButton+whiteSpace+"st_facebook_large",e[attributes.href]=directory.paths.facebook+plib.getParamsFromObject({u:encodeURI(k),t:encodeURIComponent(j)}),plib.click(plib.domAppend(html.a,d,e),function(){pfunc.openPopupWindow(plib.attribute(this,attributes.href),1e3,640)}),f.updateInProgress=!0,plib.removeElement(i),i=f.drawTagBubble(g,b),plib.removeEvent(g,events.mouseout),plib.addEvent(g,events.mouseout,function(a){new pfunc.MouseBoundaryCrossing(a,this).leftLandmark&&(f.updateInProgress=!1,f.updateNode(!0))
})}},pfunc={systemStart:function(){var a=document.getElementById(sysName+"SEO"),b=function(){clearTimeout(scrollMem),scrollMem=setTimeout(function(){plib.isObjectEmpty(hiddenImages)?settings.forceListen||(plib.removeEvent(document,support.propertychange),plib.removeEvent(document,events.scroll)):plib.loopObject(hiddenImages,function(a){pfunc.loadImage(a.image)}),settings.forceListen&&pfunc.checkForImages()},settings.scrollDelay)};if(alive)return void pfunc.warn(messages.alreadyAlive);for(alive=!0,stats={nImagesFound:0,nImagesLoaded:0,nImagesDenied:0},settings.custom&&!plib.isObjectEmpty(settings.custom)&&plib.hasProperty(settings.custom,document.body.id)&&pfunc.updateSettings(settings.custom[document.body.id]),pfunc.initKeyListener(),pfunc.checkSupport(),plib.isElement(a)&&(globalElements.pseudoSEO=a),globalElements.pInstActive=plib.newElement(html.div,{id:classes.docBody,"class":classes.docBody});document.body.firstChild;)globalElements.pInstActive.appendChild(document.body.firstChild);document.body.appendChild(globalElements.pInstActive),settings.animations||plib.addClass(globalElements.pInstActive,classes.noAnimation),support.rgba||plib.addClass(globalElements.pInstActive,classes.noRgbaSupport),support.boxShadow||plib.addClass(globalElements.pInstActive,classes.noBoxShadowSupport),support.borderRadius||plib.addClass(globalElements.pInstActive,classes.noBorderRadiusSupport),support.canvas||plib.isUndefined(window[oNamespace.vmlCanvas])&&(pfunc.info(messages.excanvasRequest),plib.loadScript(directory.paths.excanvas,function(){window[oNamespace.vmlCanvas].init_(document),support.canvas=pfunc.getCanvasContext(document.createElement(html.canvas)),pfunc.info(messages.excanvasReceived,support.canvas?"now supported":"still not supported")})),globalElements.pInstWrapper=plib.domAppend(html.div,globalElements.pInstActive,{"class":classes.wrapper}),settings.allowThemeManager&&pfunc.manageTheme(settings.themeFile),globalElements.pInstWindow=plib.domAppend(html.div,globalElements.pInstWrapper,{"class":classes.window}),globalElements.pInstWindowOverlay=plib.domAppend(html.div,globalElements.pInstWrapper,{"class":classes.windowOverlay}),globalElements.pInstWindowClose=plib.domAppend(html.span,globalElements.pInstWindow,{"class":classes.windowClose},"close"),globalElements.pInstWindowBody=plib.domAppend(html.div,globalElements.pInstWindow,{"class":classes.windowBody}),globalElements.pInstWindowBackground=plib.domAppend(html.div,globalElements.pInstWindow,{"class":classes.windowBackground}),plib.click(globalElements.pInstWindowOverlay,pfunc.closeWindow),plib.click(globalElements.pInstWindowClose,pfunc.closeWindow),pfunc.checkLogin(null,null,function(){pfunc.checkForImages(),(settings.smartLoad&&!plib.isObjectEmpty(hiddenImages)||settings.forceListen)&&(plib.addEvent(document,support.propertychange,b),plib.addEvent(document,events.scroll,b)),0===stats.nImagesLoaded&&pfunc.info(messages.noImages),settings.onReady&&settings.onReady.call(window[oNamespace.root]),pfunc.timeEnd(messages.sysLoadTime)})},systemStop:function(){if(!alive)return void pfunc.warn(messages.alreadyDead);for(alive=!1,plib.loopObject(cacheNodes,function(a){a.instance.destroy()}),plib.removeElement(globalElements.pInstWrapper);globalElements.pInstActive.hasChildNodes();)globalElements.pInstActive.parentNode.insertBefore(globalElements.pInstActive.firstChild,globalElements.pInstActive);plib.removeElement(globalElements.pInstActive),plib.loopObject(cacheEvents,function(a){plib.loopObject(a,function(a,b){plib.removeEvent(b.element,a)})}),globalElements={},globalKeyEvents={},cacheImages={},cacheNodes={},cacheTags={},cacheTagData={},cacheEvents={},cacheElements={},queueTagData={},jsonpHandler={},jsonpTimeout={},userInfo={},support={},hiddenImages={},stats={},settings=plib.cloneObject(defaultSettings),pfunc.updateWindowNamespace(),nLastLoginCheck=0,pfunc.info(messages.sysDestroyed)},updateWindowNamespace:function(a,b){var c={},d=function(a,b){window[oNamespace.root][a]=b,window[oNamespace.root].prototype[a]=b};a&&b?d(a,b):(d(oNamespace.globalVars,globalVars),d(oNamespace.settings,settings),d(oNamespace.defaultSettings,defaultSettings),d(oNamespace.user,userInfo),d(oNamespace.json,jsonpHandler),d(oNamespace.lib,plib),plib.loopObject({systemStart:pfunc.systemStart,systemStop:pfunc.systemStop,updateSettings:pfunc.updateSettings,loadImage:pfunc.loadImage,unLoadImage:pfunc.unLoadImage,checkForImages:pfunc.checkForImages,promptRegister:pfunc.promptRegister,promptLogin:pfunc.promptLogin,promptLogout:pfunc.promptLogout,promptAddTag:pfunc.promptAddTag,promptSettings:pfunc.promptSettings,promptOpenLightbox:pfunc.promptOpenLightbox,changeTheme:pfunc.changeTheme},function(a,b){c[a]=b}),d(oNamespace.fn,c),d(oNamespace.images,cacheImages),d(oNamespace.nodes,cacheNodes),d(oNamespace.tags,cacheTags),d(oNamespace.events,cacheEvents),d(oNamespace.elements,cacheElements))},onImageDimensionReady:function(a,b){function c(){var c={},d=function(){return c.width=plib.getWidth(a),c.height=plib.getHeight(a),0!==c.width&&0!==c.height?!0:!1};d()===!0?b.call(a,c):plib.runInterval(10,100,d,function(){b.call(a,c)})}a.complete?c():plib.addEvent(a,events.load,c)},cacheImage:function(a){var b;a.pinUID||(b=plib.randomID(10),cacheImages[b]={loaded:!1,image:a,offset:plib.getCumulativeOffset(a)},a.pinUID=b)},checkForImages:function(a){function b(a){plib.loopArray(a.getElementsByTagName(html.img),function(a){pfunc.cacheImage(a)})}return alive?(settings.loadAll?(a=a||document,plib.isElement(a)||a===document?b(a):plib.isArray(a)&&plib.loopArray(a,function(a){b(a)})):(plib.loopArray(plib.getElementsByClassName(settings.activeChildClass),function(a){pfunc.cacheImage(a)}),plib.loopArray(plib.getElementsByClassName(settings.activeParentClass),function(a){plib.loopArray(a.getElementsByTagName(html.img),function(a){pfunc.cacheImage(a)})}),settings.loadImages.length>0&&plib.loopArray(settings.loadImages,function(a){pfunc.cacheImage(a)})),plib.loopObject(cacheImages,function(a){a.loaded||pfunc.loadImage(a.image)}),void pfunc.info(messages.imageCount,stats.nImagesFound,stats.nImagesLoaded,stats.nImagesDenied)):void pfunc.warn(messages.sysNotActive)},unLoadImage:function(a,b){b=b||!1,pfunc.manageUserInputImage(a,function(a){a.destroy(b)}),delete cacheImages[a.pinUID]},loadImage:function(a){return alive?(stats.nImagesFound++,void pfunc.verifyImageReference(a,function(a){var b,c=plib.attribute(a,attributes.src),d=plib.getFileExtension(c),e=!0;a.pinUID||pfunc.cacheImage(a),b=plib.hasProperty(hiddenImages,a.pinUID)?hiddenImages[a.pinUID]:new PinInst(a,a.pinUID),plib.attribute(a,attributes.imgLoaded)===strBool[1]?(pfunc.warn(messages.badInstance),e=!1):c&&""!==plib.stripSpaces(c)?plib.inArray(settings.allowFile.split("|"),d)?plib.isElementIn(a,document)?globalElements.pseudoSEO&&plib.isElementIn(a,globalElements.pseudoSEO)&&(pfunc.warn(messages.imageIgnoreSEO,a),e=!1):(pfunc.warn(messages.imageNotFound,a),e=!1):(pfunc.warn(messages.imageBadFile,d,a),e=!1):(pfunc.warn(messages.imageNoSrc,a),e=!1),e?pfunc.onImageDimensionReady(a,function(c){if(c.width<settings.nMinWidth||c.height<settings.nMinHeight)return void pfunc.warn(messages.imageTooSmall,c.width,settings.nMinWidth,c.height,settings.nMinHeight,this);if(settings.smartLoad){if(pfunc.isHidden(this))return void(hiddenImages[this.pinUID]=b);plib.hasProperty(hiddenImages,this.pinUID)&&delete hiddenImages[this.pinUID]}stats.nImagesLoaded++,cacheImages[this.pinUID].loaded=!0,pfunc.info(messages.imageLoaded,this),b.settings=plib.cloneObject(settings),settings.custom&&!plib.isObjectEmpty(settings.custom)&&plib.hasProperty(settings.custom,a.id)&&pfunc.mergeStrictObjects(b.settings,settings.custom[a.id]),delete b.settings.custom,b.init()}):stats.nImagesDenied++})):void pfunc.warn(messages.sysNotActive)},mergeStrictObjects:function(a,b){plib.loopObject(b,function(b,c){var d,e;if(plib.hasProperty(a,b)){if(d=plib.type(a[b]),e=plib.type(c),d!==e)return void pfunc.warn(messages.badType,b,d,e);plib.isObject(c)?plib.isObjectEmpty(a[b])?a[b]=c:pfunc.mergeStrictObjects(a[b],c):a[b]=c}plib.hasProperty(a,b)||pfunc.warn(messages.settingDNF,b)})},updateSettings:function(a){pfunc.mergeStrictObjects(settings,a)},initKeyListener:function(){settings.keyListener&&plib.addEvent(document,events.keyup,function(a){var b=a.charCode||a.keyCode;plib.hasProperty(globalKeyEvents,b)&&plib.loopObject(globalKeyEvents[b],function(a){a(b)})})},newKeyListener:function(a,b,c){settings.keyListener&&(plib.isElement(b)&&(b=plib.getGUID(b)),globalKeyEvents[a]||(globalKeyEvents[a]={}),b&&(globalKeyEvents[a][b]=c))},removeKeyListener:function(a,b){settings.keyListener&&globalKeyEvents[a]&&(plib.isElement(b)&&(b=plib.getGUID(b)),globalKeyEvents[a][b]&&delete globalKeyEvents[a][b],plib.isObjectEmpty(globalKeyEvents[a])&&delete globalKeyEvents[a])},removeAllKeyListeners:function(a){settings.keyListener&&plib.loopObject(globalKeyEvents,function(b,c){c[a]&&pfunc.removeKeyListener(b,a)})},centerHorizontal:function(a){var b=plib.getWidth(a),c="-"+String(b/2)+cssUnit;plib.setStyle(a,css.margin.left,c)},centerVertical:function(a){var b=plib.getHeight(a),c="-"+String(b/2)+cssUnit;plib.setStyle(a,css.margin.top,c)},openWindow:function(a,b){plib.replaceHTML(globalElements.pInstWindowBody,a),plib.addClass(globalElements.pInstWrapper,classes.actionShowWin),pfunc.centerVertical(globalElements.pInstWindow),pfunc.newKeyListener(keyCodes.esc,globalElements.pInstWindow,function(){pfunc.closeWindow()}),b&&b.call(globalElements.pInstWindow)},openPrivateWindow:function(a,b){var c=function(){pfunc.openWindow(a,function(){var a=plib.getElementsByClassName(classes.windowUserName,this)[0];plib.domAppend(html.span,a,"Logged in as: "),plib.appendText(a,userInfo[serverKeys.user.fullName]),plib.click(plib.getElementsByClassName(classes.windowLogout,this)[0],function(){pfunc.closeWindow(),pfunc.promptLogout()}),b&&b.call(this)})};pfunc.checkLogin(function(){c()},function(){pfunc.promptLogin(function(){c()})})},closeWindow:function(){pfunc.removeKeyListener(keyCodes.esc,globalElements.pInstWindow),plib.removeClass(globalElements.pInstWrapper,classes.actionShowWin),plib.removeChildren(globalElements.pInstWindowBody)},promptConfirm:function(a,b){pfunc.openWindow(layout.confirmPrompt,function(){var c=plib.getElementsByClassName(classes.promptAccept,this)[0],d=plib.getElementsByClassName(classes.promptDeny,this)[0];plib.appendText(plib.getElementsByClassName(classes.promptMessage,this)[0],a),plib.click(c,function(){pfunc.waitButton(this,messages.formWait),plib.removeElement(d),b()}),plib.click(d,function(){pfunc.closeWindow()})})},setWindowLink:function(a,b,c){c=c||"_self",plib.click(a,function(){var a=window.open(b,c);a.focus()}),plib.attribute(a,attributes.href,b)},openPopupWindow:function(a,b,c){var d,e=window.innerWidth||document.documentElement.clientWidth||0,f=window.innerHeight||document.documentElement.clientHeight||0,g=window.screenLeft||window.screenX||0,h=window.screenTop||window.screenY||0,i=g+e/2-b/2,j=h+f/2-c/2,k=[];return plib.loopObject({toolbar:0,scrollbars:0,location:1,statusbar:0,menubar:0,resizable:1,width:b,height:c,left:Math.abs(i),top:Math.abs(j)},function(a,b){k[k.length]=a+"="+b}),d=window.open(a,plib.randomID(8),k.join(",")),window.focus&&d.focus(),d},updateUserInfo:function(a){null===a?plib.loopObjectKeys(userInfo,function(a){delete userInfo[a]}):plib.mergeObject(userInfo,a)},checkLogin:function(a,b,c){var d=(new Date).getTime(),e=d-nLastLoginCheck,f=function(d){plib.isObjectEmpty(d)?(userLogged=!1,b&&b()):(userLogged=!0,a&&a()),c&&c()};0===nLastLoginCheck||e>6e4?(nLastLoginCheck=d,plib.loadJSONP(directory.names.checkLogin,function(a){pfunc.updateUserInfo(a),f(a)})):f(userInfo)},checkPermission:function(a){userInfo[serverKeys.user.isOwner]?a&&a():pfunc.openWindow(layout.msgNoPermission)},waitButton:function(a,b){var c=pfunc.deactivateEvents(a,[events.mouseover,events.mouseout]);plib.isObjectEmpty(c)||(a.oEventMemory=c),b&&(plib.attribute(a,attributes.orgText,plib.textContentRecursive(a)),plib.textContentRecursive(a,b))},unwaitButton:function(a){plib.textContentRecursive(a,plib.attribute(a,attributes.orgText)),plib.attribute(a,attributes.orgText,null),a.oEventMemory&&(pfunc.activateEvents(a,a.oEventMemory),delete a.oEventMemory)},deactivateEvents:function(a,b){var c=plib.getGUID(a),d={};return plib.loopArray(b,function(b){cacheEvents[c]&&cacheEvents[c][b]&&(d[b]=cacheEvents[c][b].handler,plib.removeEvent(a,b))}),d},activateEvents:function(a,b){plib.loopObject(b,function(b,c){plib.addEvent(a,b,c)})},MouseBoundaryCrossing:function(a,b){a=a||window.event;var c,d,e=a.type;if(this.inLandmark=!1,this.leftLandmark=!1,this.enteredLandmark=!1,e===events.mouseout?(this.toElement=a.relatedTarget||a.toElement,this.fromElement=a.target||a.srcElement):e===events.mouseover&&(this.toElement=a.target||a.srcElement,this.fromElement=a.relatedTarget||a.fromElement),!this.toElement||!this.fromElement)return void pfunc.warn(messages.badTarget);for(c=this.fromElement;plib.isElement(c)&&c!==b;)c=c.parentNode;for(d=this.toElement;plib.isElement(d)&&d!==b;)d=d.parentNode;c===b&&d===b?this.inLandmark=!0:c===b&&d!==b?(this.leftLandmark=!0,this.inLandmark=e===events.mouseout):c!==b&&d===b&&(this.enteredLandmark=!0,this.inLandmark=e===events.mouseover)},isHidden:function(a){var b,c,d,e,f,g,h=plib.getCumulativeOffset(a),i=plib.getWidth(a),j=plib.getHeight(a),k=window.pageXOffset||document.documentElement.scrollLeft,l=window.pageYOffset||document.documentElement.scrollTop,m=window.innerWidth||document.documentElement.offsetWidth,n=window.innerHeight||document.documentElement.offsetHeight,o=function(a,b){do{if(b(a))break;a=a.offsetParent}while(a)};return o(a,function(a){return"fixed"===plib.getStyle(a,css.position).toLowerCase()?(f=a,null):void 0}),f&&(g=plib.getCumulativeOffset(f),k=g.x,l=g.y),b=h.x-k+i<0?!0:!1,c=h.x>m+k?!0:!1,d=h.y-l+j<0?!0:!1,e=h.y>n+l?!0:!1,b||c||d||e||0>i||0>j?!0:!plib.isVisible(a)},getPosPercentage:function(a){var b=plib.getEventTarget(a),c=plib.getMousePosition(a),d=plib.getCumulativeOffset(b),e=((c.x-d.x)/plib.getWidth(b)).toFixed(10),f=((c.y-d.y)/plib.getHeight(b)).toFixed(10);return{x:e,y:f}},manageKeywords:function(a){plib.addEvent(a,events.change,function(){var a=this.value.replace(regex.ltrim,"").replace(regex.rtrim,"").split(regex.csv);this.value=plib.arrayUnique(a).slice(0,10).join(", ").toLowerCase()})},loopFormFields:function(a,b){plib.loopArray(a.elements,function(a){var c=a.nodeName.toLowerCase();return c===html.input||c===html.textarea||c===html.select?b.call(a):void 0})},manageFormSubmit:function(a,b,c,d,e){plib.click(plib.getElementsByClassName(classes.formBtnSubmit,a)[0],function(){plib.fireEvent(a,events.submit)}),pfunc.loopFormFields(a,function(){plib.addEvent(this,events.focus,function(){plib.addClass(this.parentNode,classes.focus)}),plib.addEvent(this,events.blur,function(){plib.removeClass(this.parentNode,classes.focus)})}),pfunc.formFocus(a),pfunc.newKeyListener(keyCodes.enter,a,function(){plib.fireEvent(a,events.submit)}),plib.addEvent(a,events.submit,function(f){var g,h;if(plib.stopBubble(f),g=pfunc.getFormData(a),pfunc.checkRequired(a,c)){if(e&&(h=e.call(a,g)))return pfunc.displayFormError(a,h),!1;pfunc.disableForm(a),plib.loadJSONP(b,g,function(b){pfunc.enableForm(a),d.call(a,b)})}})},getFormData:function(a){var b={};return plib.loopArray(a.elements,function(a){(a.value===monetarySymbol||a.value===defaultWebProto)&&(a.value=""),a.name&&a.value&&(b[a.name]=a.value)}),b},displayFormError:function(a,b){var c=plib.getElementsByClassName(classes.formError,a)[0];b?(plib.replaceHTML(c,b),plib.loopArray(a.getElementsByTagName(html.input),function(a){a.type===types.password&&(a.value="")}),pfunc.formFocus(a)):plib.removeChildren(c)},formFocus:function(a){pfunc.loopFormFields(a,function(){return this.value?void 0:(this.focus(),null)})},checkRequired:function(a,b){var c=0,d=function(a){var b=plib.getParentByClassName(a,classes.formLabel);b||(b=plib.getParentByClassName(a,classes.formLabelSm)),a.value&&""!==a.value?b&&plib.removeClass(b,classes.formErrorRow):(c++,b&&plib.addClass(b,classes.formErrorRow))};return 1===b.length?b[0]===asterisk?pfunc.loopFormFields(a,function(){d(this)}):d(a.elements[b[0]]):b.length>0&&plib.loopArray(b,function(b){d(a.elements[b])}),c>0?(pfunc.displayFormError(a,messages.missingReqInput),!1):(pfunc.displayFormError(a,null),!0)},enableFormElement:function(a){return plib.attribute(a,attributes.disabled,null),a.nodeName.toLowerCase()===html.input&&plib.attribute(a,attributes.readonly,null),a},disableFormElement:function(a){return plib.attribute(a,attributes.disabled,attributes.disabled),a.nodeName.toLowerCase()===html.input&&plib.attribute(a,attributes.readonly,attributes.readonly),a},disableForm:function(a){var b=plib.getElementsByClassName(classes.formBtnSubmit,a)[0];plib.loopArray(a.elements,function(a){pfunc.disableFormElement(a)}),b&&pfunc.waitButton(b,messages.formWait)},enableForm:function(a){var b=plib.getElementsByClassName(classes.formBtnSubmit,a)[0];plib.loopArray(a.elements,function(a){pfunc.enableFormElement(a)}),b&&pfunc.unwaitButton(b)},manageTagSuggestionList:function(a){var b=plib.domAppend(html.div,a,{"class":classes.formDropDownDiv}),c=a.elements[names.strTagName],d=plib.getCumulativeOffset(c),e=plib.getCumulativeOffset(b.parentNode),f=function(a){plib.addEvent(a,events.mousedown,function(a){plib.stopBubble(a)})},g=function(d){clearTimeout(b.timeout),d?b.timeout=setTimeout(function(){plib.removeChildren(b),plib.appendText(b,messages.loading),plib.show(b),plib.loadJSONP(directory.names.getTagSugg,{strChars:d},function(d){plib.removeChildren(b),plib.hasClass(c.parentNode,classes.focus)&&(null===d?plib.appendText(b,messages.timeoutError):plib.isUndefined(d)?plib.textContent(b,messages.noResults):plib.loopArray(d,function(d){var e,g;g={},g[attributes.tagWebLink]=d[serverKeys.tags.webLink],g[attributes.tagKeywords]=d[serverKeys.tags.keywords].join(", "),e=plib.domAppend(html.span,b,g),g={},g[attributes.className]=classes.iconLabel,plib.domAppend(html.span,e,g),plib.appendText(e,d[serverKeys.tags.name]),f(e),plib.click(e,function(){a.elements[names.strTagName].value=plib.textContent(this),a.elements[names.strWebLink].value=plib.attribute(this,attributes.tagWebLink),a.elements[names.strKeywords].value=plib.attribute(this,attributes.tagKeywords),c.blur()},!0)}))})},300):(plib.removeChildren(b),plib.hide(b))};b.style[css.left]=String(d.x-e.x-9)+cssUnit,b.style[css.top]=String(d.y-e.y+33)+cssUnit,plib.addEvent(c,events.focus,function(){plib.addClass(this.parentNode,classes.focus),this.value&&g(this.value)}),plib.addEvent(c,events.blur,function(){plib.removeClass(this.parentNode,classes.focus),plib.removeChildren(b),plib.hide(b)}),plib.addEvent(c,events.keyup,function(){g(this.value)}),plib.hide(b)},currencyFormat:function(a){var b,c,d=function(a){var b;for(a=a.toString(),b=0;b<Math.floor((a.length-(1+b))/3);b++)a=a.substring(0,a.length-(4*b+3))+","+a.substring(a.length-(4*b+3));return a},e=function(a){return a=String(a%100),a.length<2&&(a="0"+a),a},f=function(a){return parseFloat(a)<0?"-":""};return a=a.toString().replace(regex.nump,""),a=isNaN(a)?"0":a,b=f(a),a=Math.floor(100*Math.abs(a)+.50000000001),c=e(a),a=d(Math.floor(a/100)),b+monetarySymbol+a+"."+c},urlFormat:function(a){var b=plib.parseUrl(a),c=["http","https"];return b.protocol&&plib.inArray(c,b.protocol)||(a=defaultWebProto+b.host+b.relative),a},validWebUrl:function(a){plib.addEvent(a,events.change,function(){this.value=pfunc.urlFormat(this.value)}),""===a.value?a.value=defaultWebProto:plib.fireEvent(a,events.change)},getCanvasContext:function(a,b){return plib.isUndefined(window[oNamespace.vmlCanvas])||window[oNamespace.vmlCanvas].initElement(a),b?a.getContext(b):!!a.getContext},getStylePrefixes:function(a){var b=[plib.camelize(a)];return plib.loopArray(["webkit","moz","o","ms","khtml"],function(c){b[b.length]=plib.camelize("-"+c+"-"+a)}),b},checkSupport:function(){var a,b,c=document.createElement(html.div),d=document.createElement(html.canvas);c.innerHTML='<span style="float:left;opacity:.55;"></span>',a=c.getElementsByTagName(html.span)[0],support.cssFloat=a.style.cssFloat?"cssFloat":"styleFloat",support.opacity=regex.opacity.test(a.style[css.opacity]),support.propertychange=plib.hasProperty(document,"onpropertychange")?"propertychange":"DOMAttrModified",support.canvas=pfunc.getCanvasContext(d),b=c.style.color,pfunc.attempt(function(){c.style.color="rgba(0, 0, 0, 0.5)"}),support.rgba=c.style.color!==b,support.boxShadow=!1,plib.loopArray(pfunc.getStylePrefixes("box-shadow"),function(a){return plib.isUndefined(c.style[a])?void 0:(support.boxShadow=!0,null)}),support.borderRadius=!1,plib.loopArray(pfunc.getStylePrefixes("border-radius"),function(a){return plib.isUndefined(c.style[a])?void 0:(support.borderRadius=!0,null)})},setFluidWidth:function(a){var b=plib.getWidth(a);plib.setWidth(a,"auto"),plib.setStyle(a,css.cssFloat,"left"),plib.attribute(a,attributes.fluidWidth,plib.getWidth(a)),plib.setWidth(a,b),plib.setStyle(a,css.cssFloat,"none")},isValidEmail:function(a){var b=a.lastIndexOf("@"),c=a.lastIndexOf(".");return 1>b?!1:b===a.length-1?!1:b>64?!1:a.length-b>255?!1:c>b+1&&c<a.length-1?!0:"["===a.charAt(b+1)&&"]"===a.charAt(a.length-1)?!0:!1},manageBackToLogin:function(a,b){plib.click(plib.getElementsByClassName(classes.formOption_backToLogin,a)[0],function(){pfunc.promptLogin(b)})},manageRegistration:function(a,b){plib.click(plib.getElementsByClassName(classes.formOption_register,a)[0],function(){pfunc.promptRegister(b)})},manageForgotPass:function(a,b){plib.click(plib.getElementsByClassName(classes.formOption_forgotPass,a)[0],function(){pfunc.openWindow(layout.formForgot,function(){var a=document.forms[names.formForgot];pfunc.manageBackToLogin(a,b),pfunc.manageFormSubmit(a,directory.names.forgot,[asterisk],function(a){a?pfunc.displayFormError(this,a):(pfunc.openWindow(layout.msgForgot),userLogged&&pfunc.promptLogout(),b&&b())})})})},promptRegister:function(a){pfunc.openWindow(layout.formRegister,function(){var b=document.forms[names.formRegister];pfunc.manageBackToLogin(b,a),b.elements[names.strWebURL].value=plib.parseUrl(windowLocation).host.split(".").slice(-2).join("."),pfunc.validWebUrl(b.elements[names.strWebURL]),pfunc.manageFormSubmit(b,directory.names.register,[asterisk],function(b){plib.isString(b)?pfunc.displayFormError(this,b):plib.isUndefined(b)&&(pfunc.openWindow(layout.msgRegistered),a&&a(b))},function(a){var b=a[names.strUsername];return pfunc.isValidEmail(b)?void 0:(this.elements[names.strUsername].value="",messages.invalidEmail)})})},promptLogin:function(a){pfunc.openWindow(layout.formLogin,function(){var b=document.forms[names.formLogin];pfunc.manageForgotPass(b,a),pfunc.manageRegistration(b,a),pfunc.manageFormSubmit(b,directory.names.login,[asterisk],function(b){plib.isString(b)?pfunc.displayFormError(this,b):plib.isObject(b)&&(userLogged=!0,nLastLoginCheck=0,pfunc.updateUserInfo(b),pfunc.methodSessionChange(),pfunc.closeWindow(),settings.onLogin&&settings.onLogin.call(window[oNamespace.root],b),a&&a())},function(a){var b=a[names.strUsername];return pfunc.isValidEmail(b)?void 0:(this.elements[names.strUsername].value="",messages.invalidEmail)})})},promptLogout:function(){plib.loadJSONP(directory.names.logout),userLogged=!1,nLastLoginCheck=0,pfunc.updateUserInfo(null),pfunc.methodSessionChange(),settings.onLogout&&settings.onLogout.call(window[oNamespace.root])},methodSessionChange:function(a){var b=plib.getParamsFromObject(userInfo),c=function(a){var b=this;a!==userHash&&b.ui.destroy(),b.updateNode(!0),b.ui.check()};a?c.call(a,b):plib.loopObject(cacheNodes,function(a){c.call(a.instance,b)}),userHash=b},findImageByString:function(a){var b,c=document.getElementById(a);return c?b=c:plib.loopArray(document.getElementsByTagName(html.img),function(c){(plib.attribute(c,attributes.src)===a||c.src===a)&&(b=c)}),b},verifyImageReference:function(a,b){return plib.isString(a)&&(a=pfunc.findImageByString(a)),a&&plib.isElement(a)?void(b&&b(a)):void pfunc.warn(messages.noImage)},getInstanceByImage:function(a){var b,c=plib.getGUID(a);return c&&plib.loopObject(cacheNodes,function(a,d){d.imgGUID===c&&(b=a)}),b?cacheNodes[b].instance:void 0},manageUserInputImage:function(a,b){pfunc.verifyImageReference(a,function(a){var c=pfunc.getInstanceByImage(a);return c?void(b&&b(c)):void pfunc.warn(messages.noInstance)})},getTagGuidObject:function(a){var b={tagGUID:plib.attribute(a,attributes.tagGuid)};return b.tagGUID||(delete b.tagGUID,b.tagMultiGUID=plib.attribute(a,attributes.tagMultiGuid)),b.tagMultiGUID||delete b.tagMultiGUID,plib.isObjectEmpty(b)?void 0:b},promptAddTag:function(a){var b=function(){this.startTaggingMode(this.methodAddNewTag)};pfunc.manageUserInputImage(a,function(a){pfunc.checkLogin(function(){b.call(a)},function(){pfunc.promptLogin(function(){b.call(a)})})})},promptRepositionTags:function(a){pfunc.manageUserInputImage(a,function(a){pfunc.checkLogin(function(){a.startTagRepositionMode()},function(){pfunc.promptLogin(function(){a.startTagRepositionMode()})})})},promptRemoveTags:function(a){pfunc.manageUserInputImage(a,function(a){pfunc.checkLogin(function(){a.startTagRemovalMode()},function(){pfunc.promptLogin(function(){a.startTagRemovalMode()})})})},promptOpenLightbox:function(a){var b,c,d,e,f,g,h,i=0,j=0,k=[],l=function(a){var b=e.children[a],c=function(a){plib.show(a),pfunc.centerVertical(d),pfunc.centerHorizontal(d)};plib.loopArray(e.children,plib.hide),"img"===b.nodeName.toLowerCase()?pfunc.onImageDimensionReady(b,function(){c(this),pfunc.loadImage(this),k.push(cacheNodes[this.pinUID])}):c(b)},m=function(){i-=1,0>i&&(i=h),l(i)},n=function(){i+=1,i>h&&(i=0),l(i)},o=function(){plib.loopArray(k,function(a){a.instance.destroy()}),k=[],plib.removeElement(b)},p=function(){var a=plib.getElementsByClassName(classes.lightboxOverlay)[0];a&&plib.fireEvent(a,"click")};p(),plib.isObjectEmpty(cacheImages)||(b=plib.domAppend(html.div,globalElements.pInstActive,{"class":classes.lightbox}),c=plib.domAppend(html.div,b,{"class":classes.lightboxOverlay}),d=plib.domAppend(html.div,b,{"class":classes.lightboxWindow}),e=plib.domAppend(html.div,d,{"class":classes.lightboxImageHolder}),f=plib.domAppend(html.div,d,{"class":classes.lightboxNav+whiteSpace+classes.lightboxShowLeft}),g=plib.domAppend(html.div,d,{"class":classes.lightboxNav+whiteSpace+classes.lightboxShowRight}),plib.domAppend(html.span,f,{"class":classes.lightboxNavIcon}),plib.domAppend(html.span,g,{"class":classes.lightboxNavIcon}),plib.click(c,o),plib.click(f,m),plib.click(g,n),pfunc.newKeyListener(keyCodes.arrowLeft,b,m),pfunc.newKeyListener(keyCodes.arrowRight,b,n),plib.loopObject(cacheImages,function(b,c){b===a.pinUID&&(i=j),c.image.src!==window.location.href&&(plib.domAppend(html.img,e,{"class":classes.lightboxImage,src:c.image.src}),j+=1)}),h=j-1,l(i))},promptSettings:function(a){pfunc.openPrivateWindow(layout.formSettings,function(){var b=document.forms[names.formSettings];plib.click(b.elements[names.btnRepositionTags],function(){pfunc.promptRepositionTags(a),pfunc.closeWindow()}),plib.click(b.elements[names.btnRemoveTags],function(){pfunc.promptRemoveTags(a),pfunc.closeWindow()}),plib.click(b.elements[names.btnOpenLightbox],function(){pfunc.closeWindow(),pfunc.promptOpenLightbox(a)}),cacheTagData[a.src]&&cacheTagData[a.src][1]?(plib.show(b.elements[names.btnRepositionTags]),plib.show(b.elements[names.btnRemoveTags])):(plib.hide(b.elements[names.btnRepositionTags]),plib.hide(b.elements[names.btnRemoveTags]))})},startDragging:function(a){plib.addEvent(document,events.mousemove,function(b){var c=plib.getMousePosition(b),d=plib.getCumulativeOffset(a.parentNode),e=c.x-d.x,f=c.y-d.y,g=plib.getWidth(a.parentNode),h=plib.getHeight(a.parentNode),i={},j=10;j>e?e=j:e>g-j-1&&(e=g-j-1),j>f?f=j:f>h-j-1&&(f=h-j-1),plib.attribute(a,attributes.tagPosX,(e/g).toFixed(10)),plib.attribute(a,attributes.tagPosY,(f/h).toFixed(10)),i[css.left]=e,i[css.top]=f,plib.setStyles(a,i)})},stopDragging:function(){plib.removeEvent(document,events.mousemove)},getLocalStorage:function(a){var b,c,d;return settings.allowLocalStorage&&window.localStorage&&window.JSON&&(b=localStorage.getItem(a).split("_"),d=b.shift(),c=b.join("_"),d===BOOLEAN_TYPE?c="true"===c:d===NUMBER_TYPE?c=parseFloat(c):d===DATE_TYPE?c=new Date(c):(d===ARRAY_TYPE||d===OBJECT_TYPE)&&(c=JSON.parse(c))),c},setLocalStorage:function(a,b){var c;if(settings.allowLocalStorage&&window.localStorage&&window.JSON){if(c=plib.type(b),c===NULL_TYPE||c===UNDEFINED_TYPE||c===ELEMENT_TYPE||c===FUNCTION_TYPE)return;c===BOOLEAN_TYPE||c===NUMBER_TYPE||c===DATE_TYPE?b=b.toString():(c===ARRAY_TYPE||c===OBJECT_TYPE)&&(b=JSON.stringify(b)),localStorage.setItem(a,c+"_"+b)}},manageTheme:function(a){var b,c;a&&""!==a&&(c=parseInt(a.split(".")[0],10),plib.getStyle(globalElements.pInstWrapper,css.zIndex)!==c&&(b={},b[attributes.href]=directory.paths.themes+a,b[attributes.rel]="stylesheet",b[attributes.type]=types.csstxt,plib.domAppend(html.link,document.getElementsByTagName(html.head)[0],b)),plib.addClass(globalElements.pInstActive,cssPrefix+c),pfunc.info(messages.themeLoaded,c))},changeTheme:function(a){plib.loopObject(cacheNodes,function(a){a.instance.destroy()}),pfunc.manageTheme(a),pfunc.checkForImages()},log:function(){pfunc.print(arguments,0)},info:function(){pfunc.print(arguments,1)},warn:function(){pfunc.print(arguments,2)},error:function(){pfunc.print(arguments,3)},time:function(){pfunc.print(arguments,4)},timeEnd:function(){pfunc.print(arguments,5)},print:function(a,b){b=consoleMethods[b],plib.isUndefined(consoleObject)||plib.isNull(consoleObject)||(a=Array.prototype.slice.call(a),plib.isFunction(consoleObject[b])?consoleObject[b].apply(consoleObject,a):plib.isObject(consoleObject[b])&&Function.prototype.call.call(consoleObject[b],consoleObject,a))},attempt:function(a){try{a.call()}catch(b){pfunc.error(sysName+plib.stringFormat(": ({0}) {1}: {2}",[b.number,b.name,b.message]))}},isMobile:function(){return regex.mobile.test(navigator.userAgent)}},window[oNamespace.root]=Pinup;
